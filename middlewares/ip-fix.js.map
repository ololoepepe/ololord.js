{"version":3,"sources":["middlewares/ip-fix.js"],"names":[],"mappings":";;AAAA,IAAI,WAAW,QAAQ,YAAR,EAAsB,QAArC;AACA,IAAI,WAAW,QAAQ,YAAR,EAAsB,QAArC;;AAEA,IAAI,SAAS,QAAQ,mBAAR,CAAb;AACA,IAAI,QAAQ,QAAQ,kBAAR,CAAZ;;AAEA,IAAI,OAAO,OAAO,yBAAP,EAAkC,KAAlC,CAAX;;AAEA,OAAO,OAAP,GAAiB,UAAS,GAAT,EAAc,GAAd,EAAmB,IAAnB,EAAyB;AACtC,QAAI,QAAQ,IAAI,MAAJ,CAAW,EAAvB,EAA2B;AACvB,eAAO,cAAP,CAAsB,GAAtB,EAA2B,IAA3B,EAAiC,EAAE,OAAO,IAAI,MAAJ,CAAW,EAApB,EAAjC;AACA;AACA;AACH;AACD,QAAI,SAAS,MAAM,cAAN,CAAqB,IAAI,EAAJ,IAAU,IAAI,UAAJ,CAAe,aAA9C,CAAb;AACA,QAAI,CAAC,MAAL,EACI,OAAO,IAAI,UAAJ,CAAe,GAAf,CAAP;AACJ,QAAI,OAAO,qBAAP,EAA8B,IAA9B,CAAJ,EAAyC;AACrC,YAAI,KAAK,IAAI,OAAJ,CAAY,iBAAZ,CAAT;AACA,YAAI,CAAC,EAAL,EACI,KAAK,IAAI,OAAJ,CAAY,aAAZ,CAAL;AACJ,YAAI,EAAJ,EAAQ;AACJ,gBAAI,UAAU,MAAM,cAAN,CAAqB,EAArB,CAAd;AACA,gBAAI,CAAC,OAAL,EACI,OAAO,IAAI,UAAJ,CAAe,GAAf,CAAP;AACJ,qBAAS,OAAT;AACH;AACJ;AACD,QAAI,OAAO,mBAAP,EAA4B,KAA5B,CAAJ,EAAwC;AACpC,YAAI,KAAK,IAAI,OAAJ,CAAY,WAAZ,CAAT;AACA,YAAI,UAAU,MAAM,cAAN,CAAqB,EAArB,CAAd;AACA,YAAI,CAAC,OAAL,EACI,OAAO,IAAI,UAAJ,CAAe,GAAf,CAAP;AACJ,iBAAS,OAAT;AACH;AACD,WAAO,cAAP,CAAsB,GAAtB,EAA2B,IAA3B,EAAiC,EAAE,OAAO,MAAT,EAAjC;AACA,QAAI,IAAJ,EACI,OAAO,cAAP,CAAsB,IAAI,MAA1B,EAAkC,IAAlC,EAAwC,EAAE,OAAO,MAAT,EAAxC;AACJ;AACH,CA/BD","file":"middlewares/ip-fix.js","sourcesContent":["var Address4 = require(\"ip-address\").Address4;\nvar Address6 = require(\"ip-address\").Address6;\n\nvar config = require(\"../helpers/config\");\nvar Tools = require(\"../helpers/tools\");\n\nvar fast = config(\"system.fastIPRetrieving\", false);\n\nmodule.exports = function(req, res, next) {\n    if (fast && req.socket.ip) {\n        Object.defineProperty(req, \"ip\", { value: req.socket.ip });\n        next();\n        return;\n    }\n    var trueIp = Tools.correctAddress(req.ip || req.connection.remoteAddress);\n    if (!trueIp)\n        return res.sendStatus(500);\n    if (config(\"system.detectRealIp\", true)) {\n        var ip = req.headers[\"x-forwarded-for\"];\n        if (!ip)\n            ip = req.headers[\"x-client-ip\"];\n        if (ip) {\n            var address = Tools.correctAddress(ip);\n            if (!address)\n                return res.sendStatus(500);\n            trueIp = address;\n        }\n    }\n    if (config(\"system.useXRealIp\", false)) {\n        var ip = req.headers[\"x-real-ip\"];\n        var address = Tools.correctAddress(ip);\n        if (!address)\n            return res.sendStatus(500);\n        trueIp = address;\n    }\n    Object.defineProperty(req, \"ip\", { value: trueIp });\n    if (fast)\n        Object.defineProperty(req.socket, \"ip\", { value: trueIp });\n    next();\n};\n"],"sourceRoot":"/source/"}