{"version":3,"sources":["models/misc.js"],"names":[],"mappings":"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","file":"models/misc.js","sourcesContent":["import _ from 'underscore';\nimport FS from 'q-io/fs';\nimport FSSync from 'fs';\nimport Highlight from 'highlight.js';\n\nimport Board from '../boards/board';\nimport markup from '../core/markup';\nimport config from '../helpers/config';\nimport FSWatcher from '../helpers/fs-watcher';\nimport * as Tools from '../helpers/tools';\n\nlet langNames = Tools.createWatchedResource(`${__dirname}/misc/lang-names.json`, (path) => {\n  return require(path);\n}, async function(path) {\n  let data = await FS.read(path);\n  langNames = JSON.parse(data);\n}) || {};\n\nfunction filterNotFoundImageFileNames(fileName) {\n  return '.gitignore' !== fileName;\n}\n\nlet notFoundImageFileNames = Tools.createWatchedResource(`${__dirname}/../public/img/404`, (path) => {\n  return FSSync.readdirSync(path).filter(filterNotFoundImageFileNames);\n}, async function(path) {\n  let fileNames = await FS.list(path);\n  return fileNames.filter(filterNotFoundImageFileNames);\n}) || [];\n\nexport function base() {\n  let Captcha = Tools.requireWrapper(require('../captchas/captcha'));\n  return {\n    site: {\n      protocol: config('site.protocol'),\n      domain: config('site.domain'),\n      pathPrefix: config('site.pathPrefix'),\n      locale: config('site.locale'),\n      dateFormat: config('site.dateFormat'),\n      timeOffset: config('site.timeOffset'),\n      twitter: { integrationEnabled: !!config('site.twitter.integrationEnabled') },\n      vkontakte: {\n        integrationEnabled: !!config('site.vkontakte.integrationEnabled'),\n        appId: config('site.vkontakte.appId')\n      },\n      ws: { transports: config('site.ws.transports') }\n    },\n    styles: Tools.STYLES,\n    codeStyles: Tools.CODE_STYLES,\n    availableCodeLangs: Highlight.listLanguages().map((lang) => {\n      return {\n        id: lang,\n        name: langNames[lang] || lang\n      };\n    }),\n    maxSearchQueryLength: config('site.maxSearchQueryLength'),\n    markupModes: [{\n      name: 'NONE',\n      title: Tools.translate('No markup', 'markupMode')\n    }, {\n      name: markup.MarkupModes.ExtendedWakabaMark,\n      title: Tools.translate('Extended WakabaMark only', 'markupMode')\n    }, {\n      name: markup.MarkupModes.BBCode,\n      title: Tools.translate('bbCode only', 'markupMode')\n    }, {\n      name: (markup.MarkupModes.ExtendedWakabaMark + ',' + markup.MarkupModes.BBCode),\n      title: Tools.translate('Extended WakabaMark and bbCode', 'markupMode')\n    }],\n    supportedCaptchaEngines: Captcha.captchaIds().filter((id) => {\n      return 'node-captcha-noscript' !== id;\n    }).map(id => Captcha.captcha(id).info())\n  };\n}\n\nfunction sort(x1, x2) {\n  if (!x1.priority && !x2.priority) {\n    return x1.name.localeCompare(x2.name);\n  }\n  return (x1.priority || 0) - (x2.priority || 0);\n}\n\nexport function boards() {\n  let boards = Board.boardNames().map(boardName => Board.board(boardName).info());\n  let addDefault = false;\n  let boardGroups = _(config('boardGroups', {})).map((group, name) => {\n    group.name = name;\n    group.boards = boards.reduce((acc, board) => {\n      if (!board.groupName) {\n        addDefault = true;\n      } else if (name === board.groupName) {\n        acc.push(board);\n      }\n      return acc;\n    }, []);\n    return group;\n  });\n  if (addDefault || boardGroups.length < 1) {\n    let noGroups = (boardGroups.length < 1);\n    boardGroups.push({\n      name: '',\n      boards: boards.filter((board) => { return noGroups || (!board.hidden && !board.groupName); })\n    });\n  }\n  boardGroups = boardGroups.filter((group) => { return group.boards.length > 0; });\n  boardGroups.sort(sort);\n  boardGroups.forEach((group) => { group.boards.sort(sort); });\n  return {\n    boards: boards,\n    boardGroups: boardGroups\n  };\n}\n\nexport function board(brd) {\n  if (typeof brd === 'string') {\n    brd = Board.board(brd);\n  }\n  return brd ? { board: brd.info() } : null;\n}\n\nexport function translations() {\n  return { tr: Tools.translate.translations };\n}\n\nexport function notFoundImageFileNames() {\n  return notFoundImageFileNames;\n}\n\nexport function codeLangNames() {\n  return langNames;\n}\n"],"sourceRoot":"/source/"}