{"version":3,"sources":["storage/unordered-set.js"],"names":[],"mappings":"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","file":"storage/unordered-set.js","sourcesContent":["import _ from 'underscore';\n\nimport * as Tools from '../helpers/tools';\n\nexport default class UnorderedSet {\n  constructor(client, key, { parse, stringify } = {}) {\n    this.client = client;\n    this.key = key;\n    this.parse = Tools.selectParser(parse);\n    this.stringify = Tools.selectStringifier(stringify);\n  }\n\n  fullKey(subkey, separator) {\n    return this.key + (subkey ? `${separator || ':'}${subkey}` : '');\n  }\n\n  async getOne(subkey) {\n    let data = await this.client.srandmember(this.fullKey(subkey));\n    return this.parse(data);\n  }\n\n  async getAll(subkey) {\n    let data = await this.client.smembers(this.fullKey(subkey));\n    return data.map(this.parse);\n  }\n\n  async contains(data, subkey) {\n    let contains = await this.client.sismember(this.fullKey(subkey), this.stringify(data));\n    return !!contains;\n  }\n\n  async exists(subkey) {\n    let exists = await this.client.exists(this.fullKey(subkey));\n    return !!exists;\n  }\n\n  async addOne(data, subkey) {\n    return await this.client.sadd(this.fullKey(subkey), this.stringify(data));\n  }\n\n  async addSome(list, subkey) {\n    if (!list || !_(list).isArray() || list.length <= 0) {\n      return 0;\n    }\n    return await this.client.sadd.call(this.client, this.fullKey(subkey), ...list.map(this.stringify));\n  }\n\n  async deleteOne(data, subkey) {\n    return await this.client.srem(this.fullKey(subkey), this.stringify(data));\n  }\n\n  async deleteSome(list, subkey) {\n    if (!list || !_(list).isArray() || list.length <= 0) {\n      return 0;\n    }\n    return await this.client.srem.call(this.client, this.fullKey(subkey), ...list.map(this.stringify));\n  }\n\n  async count(subkey) {\n    return await this.client.scard(this.fullKey(subkey));\n  }\n\n  async find(query, subkey) {\n    query = (typeof query !== 'undefined') ? `:${query}` : ':*';\n    return await this.client.keys(this.fullKey(subkey) + query);\n  }\n\n  async delete(subkey) {\n    return await this.client.del(this.fullKey(subkey));\n  }\n}\n"],"sourceRoot":"/source/"}