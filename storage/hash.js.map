{"version":3,"sources":["storage/hash.js"],"names":[],"mappings":"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","file":"storage/hash.js","sourcesContent":["import _ from 'underscore';\n\nimport * as Tools from '../helpers/tools';\n\nexport default class Hash {\n  constructor(client, key, { parse, stringify } = {}) {\n    this.client = client;\n    this.key = key;\n    this.parse = Tools.selectParser(parse);\n    this.stringify = Tools.selectStringifier(stringify);\n  }\n\n  fullKey(subkey, separator) {\n    return this.key + (subkey ? `${separator || ':'}${subkey}` : '');\n  }\n\n  async getOne(id, subkey) {\n    let data = await this.client.hget(this.fullKey(subkey), id);\n    return this.parse(data);\n  }\n\n  async getSome(ids, subkey) {\n    if (!_(ids).isArray() || ids.length <= 0) {\n      return [];\n    }\n    let data = await this.client.hmget.call(this.client, this.fullKey(subkey), ...ids);\n    return data.map(this.parse);\n  }\n\n  async getAll(subkey) {\n    let data = await this.client.hgetall(this.fullKey(subkey));\n    return _(data).mapObject(this.parse);\n  }\n\n  async exists(subkey) {\n    let exists = await this.client.exists(this.fullKey(subkey));\n    return !!exists;\n  }\n\n  async existsOne(id, subkey) {\n    let exists = await this.client.hexists(this.fullKey(subkey), id);\n    return !!exists;\n  }\n\n  async setOne(id, data, subkey) {\n    return await this.client.hset(this.fullKey(subkey), id, this.stringify(data));\n  }\n\n  async setSome(items, subkey) {\n    if (typeof items !== 'object') {\n      return 0;\n    }\n    if (!_(items).isArray()) {\n      items = _(items).map((value, key) => { return [key, value]; });\n      items = _(items).flatten();\n    }\n    if (items.length <= 0) {\n      return 0;\n    }\n    return await this.client.hmset.call(this.client, this.fullKey(subkey), ...items);\n  }\n\n  async incrementBy(id, n, subkey) {\n    return await this.client.hincrby(this.fullKey(subkey), key, n);\n  }\n\n  async deleteOne(id, subkey) {\n    return await this.client.hdel(this.fullKey(subkey), id);\n  }\n\n  async deleteSome(ids, subkey) {\n    if (!_(ids).isArray()) {\n      ids = [ids];\n    }\n    if (ids.length <= 0) {\n      return 0;\n    }\n    return await this.client.hdel(this.fullKey(subkey), ...ids);\n  }\n\n  async keys(subkey) {\n    return await this.client.hkeys(this.fullKey(subkey));\n  }\n\n  async count(subkey) {\n    return await this.client.hlen(this.fullKey(subkey));\n  }\n\n  async find(query, subkey) {\n    query = (typeof query !== 'undefined') ? `:${query}` : ':*';\n    return await this.client.keys(this.fullKey(subkey) + query);\n  }\n\n  async delete(subkey) {\n    return await this.client.del(this.fullKey(subkey));\n  }\n}\n"],"sourceRoot":"/source/"}