{"version":3,"sources":["storage/common-key.js"],"names":[],"mappings":";;;;;;;;;;;;AAAA,SAAS,YAAT,CAAsB,KAAtB,EAA6B;AAC3B,MAAI,OAAO,KAAP,KAAiB,UAArB,EAAiC;AAC/B,WAAO,UAAC,IAAD,EAAU;AACf,UAAI,OAAO,IAAP,KAAgB,MAAhB,IAA0B,OAAO,IAAP,KAAgB,WAA9C,EAA2D;AACzD,eAAO,IAAP;AACD;AACD,aAAO,MAAM,IAAN,CAAP;AACD,KALD;AAMD,GAPD,MAOO,IAAI,SAAS,OAAO,KAAP,KAAiB,WAA9B,EAA2C;AAChD,WAAO,UAAC,IAAD,EAAU;AACf,UAAI,OAAO,IAAP,KAAgB,QAApB,EAA8B;AAC5B,eAAO,IAAP;AACD;AACD,aAAO,KAAK,KAAL,CAAW,IAAX,CAAP;AACD,KALD;AAMD,GAPM,MAOA;AACL,WAAO;AAAA,aAAQ,IAAR;AAAA,KAAP;AACD;AACF;;AAED,SAAS,iBAAT,CAA2B,SAA3B,EAAsC;AACpC,MAAI,OAAO,SAAP,KAAqB,UAAzB,EAAqC;AACnC,WAAO,UAAC,IAAD,EAAU;AACf,UAAI,OAAO,IAAP,KAAgB,MAAhB,IAA0B,OAAO,IAAP,KAAgB,WAA9C,EAA2D;AACzD,eAAO,IAAP;AACD;AACD,aAAO,UAAU,IAAV,CAAP;AACD,KALD;AAMD,GAPD,MAOO,IAAI,aAAa,OAAO,SAAP,KAAqB,WAAtC,EAAmD;AACxD,WAAO,KAAK,SAAL,CAAe,IAAf,CAAoB,IAApB,CAAP;AACD,GAFM,MAEA;AACL,WAAO;AAAA,aAAQ,IAAR;AAAA,KAAP;AACD;AACF;;IAEoB,S;AACnB,qBAAY,MAAZ,EAAoB,GAApB,EAAoD;AAAA,qEAAJ,EAAI;;AAAA,QAAzB,KAAyB,QAAzB,KAAyB;AAAA,QAAlB,SAAkB,QAAlB,SAAkB;;AAAA;;AAClD,SAAK,MAAL,GAAc,MAAd;AACA,SAAK,GAAL,GAAW,GAAX;AACA,SAAK,KAAL,GAAa,aAAa,KAAb,CAAb;AACA,SAAK,SAAL,GAAiB,kBAAkB,SAAlB,CAAjB;AACD;;;;4BAEO,M,EAAQ,S,EAAW;AACzB,aAAO,KAAK,GAAL,IAAY,eAAY,aAAa,GAAzB,IAA+B,MAA/B,GAA0C,EAAtD,CAAP;AACD;;;;2EAEY,M;YACP,M;;;;;;uBAAe,KAAK,MAAL,CAAY,MAAZ,CAAmB,KAAK,OAAL,CAAa,MAAb,CAAnB,C;;;AAAf,sB;iDACG,CAAC,CAAC,M;;;;;;;;;;;;;;;;;;;4EAGA,K,EAAO,M;;;;;AAChB,wBAAS,OAAO,KAAP,KAAiB,WAAlB,SAAqC,KAArC,GAA+C,IAAvD;;uBACa,KAAK,MAAL,CAAY,IAAZ,CAAiB,KAAK,OAAL,CAAa,MAAb,IAAuB,KAAxC,C;;;;;;;;;;;;;;;;;;;;;;4EAGF,M;;;;;;uBACE,KAAK,MAAL,CAAY,GAAZ,CAAgB,KAAK,OAAL,CAAa,MAAb,CAAhB,C;;;;;;;;;;;;;;;;;;;;;;;;kBAvBI,S","file":"storage/common-key.js","sourcesContent":["function selectParser(parse) {\n  if (typeof parse === 'function') {\n    return (data) => {\n      if (typeof data === 'null' || typeof data === 'undefined') {\n        return data;\n      }\n      return parse(data);\n    };\n  } else if (parse || typeof parse === 'undefined') {\n    return (data) => {\n      if (typeof data !== 'string') {\n        return data;\n      }\n      return JSON.parse(data);\n    };\n  } else {\n    return data => data;\n  }\n}\n\nfunction selectStringifier(stringify) {\n  if (typeof stringify === 'function') {\n    return (data) => {\n      if (typeof data === 'null' || typeof data === 'undefined') {\n        return data;\n      }\n      return stringify(data);\n    };\n  } else if (stringify || typeof stringify === 'undefined') {\n    return JSON.stringify.bind(null);\n  } else {\n    return data => data;\n  }\n}\n\nexport default class CommonKey {\n  constructor(client, key, { parse, stringify } = {}) {\n    this.client = client;\n    this.key = key;\n    this.parse = selectParser(parse);\n    this.stringify = selectStringifier(stringify);\n  }\n\n  fullKey(subkey, separator) {\n    return this.key + (subkey ? `${separator || ':'}${subkey}` : '');\n  }\n\n  async exists(subkey) {\n    let exists = await this.client.exists(this.fullKey(subkey));\n    return !!exists;\n  }\n\n  async find(query, subkey) {\n    query = (typeof query !== 'undefined') ? `:${query}` : ':*';\n    return await this.client.keys(this.fullKey(subkey) + query);\n  }\n\n  async delete(subkey) {\n    return await this.client.del(this.fullKey(subkey));\n  }\n}\n"],"sourceRoot":"/source/"}