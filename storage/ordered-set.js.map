{"version":3,"sources":["storage/ordered-set.js"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;AAEA;;;;;;;;;;;;;;;;IAEqB,U;;;AACnB,wBAAqB;AAAA;;AAAA;;AAAA,sCAAN,IAAM;AAAN,UAAM;AAAA;;AAAA,wJACV,IADU;AAEpB;;;;;2EAEa,E,EAAI,E,EAAI,M;YAChB,I;;;;;;uBAAa,KAAK,MAAL,CAAY,MAAZ,CAAmB,KAAK,OAAL,CAAa,MAAb,CAAnB,EAAyC,EAAzC,EAA6C,EAA7C,C;;;AAAb,oB;iDACG,KAAK,GAAL,CAAS,KAAK,KAAd,C;;;;;;;;;;;;;;;;;;;4EAGY,E,EAAI,E,EAAI,M;YACvB,I;;;;;;uBAAa,KAAK,MAAL,CAAY,aAAZ,CAA0B,KAAK,OAAL,CAAa,MAAb,CAA1B,EAAgD,EAAhD,EAAoD,EAApD,C;;;AAAb,oB;kDACG,KAAK,GAAL,CAAS,KAAK,KAAd,C;;;;;;;;;;;;;;;;;;;4EAGI,M;YACP,I;;;;;;uBAAa,KAAK,MAAL,CAAY,MAAZ,CAAmB,KAAK,OAAL,CAAa,MAAb,CAAnB,EAAyC,CAAzC,EAA4C,CAAC,CAA7C,C;;;AAAb,oB;kDACG,KAAK,GAAL,CAAS,KAAK,KAAd,C;;;;;;;;;;;;;;;;;;;4EAGI,I,EAAM,K,EAAO,M;;;;;;uBACX,KAAK,MAAL,CAAY,IAAZ,CAAiB,KAAK,OAAL,CAAa,MAAb,CAAjB,EAAuC,KAAK,SAAL,CAAe,IAAf,CAAvC,EAA6D,KAA7D,C;;;;;;;;;;;;;;;;;;;;;;4EAGD,I,EAAM,M;;;;;;;;sBACd,CAAC,IAAD,IAAS,CAAC,0BAAE,IAAF,EAAQ,OAAR,EAAV,IAA+B,KAAK,MAAL,IAAe,CAA9C,IAAmD,KAAK,IAAL,CAAU,UAAC,IAAD,EAAU;AAAE,yBAAO,QAAO,IAAP,yCAAO,IAAP,OAAgB,QAAvB;AAAkC,iBAAxD,C;;;;;kDAC9C,C;;;;uBAEI,qBAAK,MAAL,CAAY,IAAZ,EAAiB,IAAjB,sBAAsB,KAAK,MAA3B,EAAmC,KAAK,OAAL,CAAa,MAAb,CAAnC,4BACR,0BAAE,KAAK,GAAL,CAAS;AAAA,yBAAQ,CAAC,KAAK,KAAN,EAAa,OAAK,SAAL,CAAe,KAAK,IAApB,CAAb,CAAR;AAAA,iBAAT,CAAF,EAA6D,OAA7D,EADQ,G;;;;;;;;;;;;;;;;;;;;;;4EAIC,I,EAAM,M;;;;;;uBACP,KAAK,MAAL,CAAY,IAAZ,CAAiB,KAAK,OAAL,CAAa,MAAb,CAAjB,EAAuC,KAAK,SAAL,CAAe,IAAf,CAAvC,C;;;;;;;;;;;;;;;;;;;;;;4EAGE,I,EAAM,M;;;;;;;sBACjB,CAAC,IAAD,IAAS,CAAC,0BAAE,IAAF,EAAQ,OAAR,EAAV,IAA+B,KAAK,MAAL,IAAe,C;;;;;kDACzC,C;;;;uBAEI,qBAAK,MAAL,CAAY,IAAZ,EAAiB,IAAjB,sBAAsB,KAAK,MAA3B,EAAmC,KAAK,OAAL,CAAa,MAAb,CAAnC,4BAA4D,KAAK,GAAL,CAAS,KAAK,SAAd,CAA5D,G;;;;;;;;;;;;;;;;;;;;;;4EAGH,M;;;;;;uBACG,KAAK,MAAL,CAAY,KAAZ,CAAkB,KAAK,OAAL,CAAa,MAAb,CAAlB,C;;;;;;;;;;;;;;;;;;;;;;;;kBA5CI,U","file":"storage/ordered-set.js","sourcesContent":["import _ from 'underscore';\n\nimport CommonKey from './common-key';\n\nexport default class OrderedSet extends CommonKey {\n  constructor(...args) {\n    super(...args);\n  }\n\n  async getSome(lb, ub, subkey) {\n    let data = await this.client.zrange(this.fullKey(subkey), lb, ub);\n    return data.map(this.parse);\n  }\n\n  async getSomeByScore(lb, ub, subkey) {\n    let data = await this.client.zrangebyscore(this.fullKey(subkey), lb, ub);\n    return data.map(this.parse);\n  }\n\n  async getAll(subkey) {\n    let data = await this.client.zrange(this.fullKey(subkey), 0, -1);\n    return data.map(this.parse);\n  }\n\n  async addOne(data, score, subkey) {\n    return await this.client.zadd(this.fullKey(subkey), this.stringify(data), score);\n  }\n\n  async addSome(list, subkey) {\n    if (!list || !_(list).isArray() || list.length <= 0 || list.some((item) => { return typeof item !== 'object'; })) {\n      return 0;\n    }\n    return await this.client.zadd.call(this.client, this.fullKey(subkey),\n      ..._(list.map(item => [item.score, this.stringify(item.data)])).flatten());\n  }\n\n  async removeOne(data, subkey) {\n    return await this.client.zrem(this.fullKey(subkey), this.stringify(data));\n  }\n\n  async removeSome(list, subkey) {\n    if (!list || !_(list).isArray() || list.length <= 0) {\n      return 0;\n    }\n    return await this.client.zrem.call(this.client, this.fullKey(subkey), ...list.map(this.stringify));\n  }\n\n  async count(subkey) {\n    return await this.client.zcard(this.fullKey(subkey));\n  }\n}\n"],"sourceRoot":"/source/"}