{"version":3,"sources":["boards/board.js"],"names":[],"mappings":"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","file":"boards/board.js","sourcesContent":["import _ from 'underscore';\nvar Address6 = require(\"ip-address\").Address6;\nvar Crypto = require(\"crypto\");\nvar ffmpeg = require(\"fluent-ffmpeg\");\nvar FS = require(\"q-io/fs\");\nvar FSSync = require(\"fs\");\nvar Path = require(\"path\");\nvar promisify = require(\"promisify-node\");\nvar Util = require(\"util\");\nvar UUID = require(\"uuid\");\n\nimport config from '../helpers/config';\nimport Logger from '../helpers/logger';\nimport * as Tools from '../helpers/tools';\n\nvar durationToString = function(duration) {\n    duration = Math.floor(+duration);\n    var hours = \"\" + Math.floor(duration / 3600);\n    if (hours.length < 2)\n        hours = \"0\" + hours;\n    duration %= 3600;\n    var minutes = \"\" + Math.floor(duration / 60);\n    if (minutes.length < 2)\n        minutes = \"0\" + minutes;\n    var seconds = \"\" + (duration % 60);\n    if (seconds.length < 2)\n        seconds = \"0\" + seconds;\n    return hours + \":\" + minutes + \":\" + seconds;\n};\n\nvar Board = function(name, title, options) {\n    this.defineProperty(\"name\", name);\n    this.defineSetting(\"title\", function() {\n        return Tools.translate(title);\n    });\n    this.defineProperty(\"priority\", function() {\n        var def;\n        if (options && !isNaN(+options.priority) && +options.priority)\n            def = +options.priority;\n        else\n            def = 0;\n        return config(\"board.\" + name + \".priority\", config(\"board.priority\", def));\n    });\n    this.defineProperty(\"defaultUserName\", function() {\n        var def;\n        if (options && options.defaultUserName)\n            def = Tools.translate(options.defaultUserName);\n        else\n            def = Tools.translate(\"Anonymous\", \"defaultUserName\");\n        return config(\"board.\" + name + \".defaultUserName\", config(\"board.defaultUserName\", def));\n    });\n    this.defineProperty(\"groupName\", function() {\n        var def;\n        if (options && options.groupName)\n            def = options.groupName;\n        else\n            def = \"\";\n        return config(\"board.\" + name + \".groupName\", config(\"board.groupName\", def));\n    });\n    this.defineProperty(\"captchaEnabled\", function() {\n        return config(\"board.captchaEnabled\", true) && config(\"board.\" + name + \".captchaEnabled\", true);\n    });\n    this.defineProperty(\"bannerFileNames\", function() {\n        return Board._banners[name];\n    });\n    this.defineProperty(\"postFormRules\", function() {\n        return Board._postFormRules[name];\n    });\n    this.defineSetting(\"skippedGetOrder\", 0);\n    this.defineSetting(\"opModeration\", false);\n    this.defineSetting(\"captchaQuota\", 0);\n    this.defineSetting(\"enabled\", true);\n    this.defineSetting(\"hidden\", false);\n    this.defineSetting(\"maxEmailLength\", 150);\n    this.defineSetting(\"maxNameLength\", 50);\n    this.defineSetting(\"maxSubjectLength\", 150);\n    this.defineSetting(\"maxTextLength\", 15000);\n    this.defineSetting(\"maxPasswordLength\", 50);\n    this.defineSetting(\"maxFileCount\", 1);\n    this.defineSetting(\"maxFileSize\", 10 * 1024 * 1024);\n    this.defineSetting(\"maxLastPosts\", 3);\n    this.defineSetting(\"markupElements\", [\n        Board.MarkupElements.BoldMarkupElement,\n        Board.MarkupElements.ItalicsMarkupElement,\n        Board.MarkupElements.StrikedOutMarkupElement,\n        Board.MarkupElements.UnderlinedMarkupElement,\n        Board.MarkupElements.SpoilerMarkupElement,\n        Board.MarkupElements.QuotationMarkupElement,\n        Board.MarkupElements.UnorderedList,\n        Board.MarkupElements.OrderedList,\n        Board.MarkupElements.ListItem,\n        Board.MarkupElements.SubscriptMarkupElement,\n        Board.MarkupElements.SuperscriptMarkupElement,\n        Board.MarkupElements.UrlMarkupElement\n    ]);\n    this.defineSetting(\"postingEnabled\", true);\n    this.defineSetting(\"showWhois\", false);\n    this.defineSetting(\"supportedCaptchaEngines\", Tools.requireWrapper(require('../captchas/captcha')).captchaIds());\n    this.defineProperty(\"permissions\", function() {\n        var p = {};\n        Tools.forIn(require(\"../helpers/permissions\").Permissions, function(defLevel, key) {\n            p[key] = config(\"board.\" + name + \".permissions.\" + key, config(\"permissions.\" + key, defLevel));\n        });\n        return p;\n    });\n    this.defineSetting(\"supportedFileTypes\", [\n        \"application/ogg\",\n        \"application/pdf\",\n        \"audio/mpeg\",\n        \"audio/ogg\",\n        \"audio/wav\",\n        \"image/gif\",\n        \"image/jpeg\",\n        \"image/png\",\n        \"video/mp4\",\n        \"video/ogg\",\n        \"video/webm\"\n    ]);\n    this.defineSetting(\"bumpLimit\", 500);\n    this.defineSetting(\"postLimit\", 1000);\n    this.defineSetting(\"threadLimit\", 200);\n    this.defineSetting(\"archiveLimit\", 0);\n    this.defineSetting(\"threadsPerPage\", 20);\n    this.defineProperty(\"launchDate\", function() {\n        return new Date(config(\"board.\" + name + \".launchDate\", config(\"board.launchDate\", new Date())));\n    });\n};\n\nBoard.boards = {};\n\n/*public*/ Board.prototype.defineSetting = function(name, def) {\n    var _this = this;\n    Object.defineProperty(this, name, {\n        get: function() {\n            return config(\"board.\" + _this.name + \".\" + name,\n                config(\"board.\" + name, (typeof def == \"function\") ? def() : def));\n        },\n        configurable: true\n    });\n};\n\n/*public*/ Board.prototype.defineProperty = function(name, value) {\n    var _this = this;\n    if (typeof value == \"function\") {\n        Object.defineProperty(this, name, {\n            get: value,\n            configurable: true\n        });\n    } else {\n        Object.defineProperty(this, name, {\n            value: value,\n            configurable: true\n        });\n    }\n};\n\n/*public*/ Board.prototype.info = function() {\n    var _this = this;\n    var model = {\n        name: this.name,\n        title: this.title,\n        defaultUserName: this.defaultUserName,\n        groupName: this.groupName,\n        showWhois: this.showWhois,\n        hidden: this.hidden,\n        postingEnabled: this.postingEnabled,\n        captchaEnabled: this.captchaEnabled,\n        maxEmailLength: this.maxEmailLength,\n        maxNameLength: this.maxNameLength,\n        maxSubjectLength: this.maxSubjectLength,\n        maxTextLength: this.maxTextLength,\n        maxPasswordLength: this.maxPasswordLength,\n        maxFileCount: this.maxFileCount,\n        maxFileSize: this.maxFileSize,\n        maxLastPosts: this.maxLastPosts,\n        markupElements: this.markupElements,\n        supportedFileTypes: this.supportedFileTypes,\n        supportedCaptchaEngines: this.supportedCaptchaEngines,\n        bumpLimit: this.bumpLimit,\n        postLimit: this.postLimit,\n        bannerFileNames: this.bannerFileNames,\n        postFormRules: this.postFormRules,\n        launchDate: this.launchDate.toISOString(),\n        permissions: this.permissions,\n        opModeration: this.opModeration\n    };\n    this.customBoardInfoFields().forEach(function(field) {\n        model[field] = _this[field];\n    });\n    return model;\n};\n\n/*public*/ Board.prototype.customBoardInfoFields = function() {\n    return [];\n};\n\n/*public*/ Board.prototype.isCaptchaEngineSupported = function(engineName) {\n    if (typeof engineName != \"string\")\n        return;\n    return Tools.contains(this.supportedCaptchaEngines, engineName);\n};\n\n/*public*/ Board.prototype.isFileTypeSupported = function(fileType) {\n    if (typeof fileType != \"string\")\n        return;\n    return Tools.contains(this.supportedFileTypes, fileType);\n};\n\n/*public*/ Board.prototype.postExtraData = function(req, fields, files, oldPost) {\n    return Promise.resolve(oldPost ? oldPost.extraData : null);\n};\n\n/*public*/ Board.prototype.storeExtraData = function(postNumber, extraData) {\n    if (Util.isNullOrUndefined(extraData))\n        return Promise.resolve();\n    return Promise.resolve();\n    //return Database.db.hset(\"postExtraData\", this.name + \":\" + postNumber, JSON.stringify(extraData));\n};\n\n/*public*/ Board.prototype.loadExtraData = function(postNumber) {\n    var _this = this;\n    return Promise.resolve();\n    /*return Database.db.hget(\"postExtraData\", this.name + \":\" + postNumber).then(function(extraData) {\n        if (Util.isNullOrUndefined(extraData))\n            return Promise.resolve(null);\n        return JSON.parse(extraData);\n    });*/\n};\n\n/*public*/ Board.prototype.removeExtraData = function(postNumber) {\n    return Promise.resolve();\n    //return Database.db.hdel(\"postExtraData\", this.name + \":\" + postNumber);\n};\n\n/*public*/ Board.prototype.apiRoutes = function() {\n    return []; //[ { method, path, handler }, ... ]\n};\n\n/*public*/ Board.prototype.actionRoutes = function() {\n    return []; //[ { method, path, handler }, ... ]\n};\n\n/*public*/ Board.prototype.extraScripts = function() {\n    return [];\n};\n\n/*public*/ Board.prototype.extraStylesheets = function() {\n    return [];\n};\n\n/*public*/ Board.prototype.testParameters = function(mode, fields, files, existingFileCount) {\n  let { name, subject, text, password } = fields;\n  name = name || '';\n  subject = subject || '';\n  text = text || '';\n  password = password || '';\n  if (name.length > this.maxNameLength) {\n    return Promise.reject(new Error(Tools.translate('Name is too long')));\n  }\n  if (subject.length > this.maxSubjectLength) {\n    return Promise.reject(new Error(Tools.translate('Subject is too long')));\n  }\n  if (text.length > this.maxTextFieldLength) {\n    return Promise.reject(new Error(Tools.translate('Comment is too long')));\n  }\n  if (password.length > this.maxPasswordLength) {\n    return Promise.reject(new Error(Tools.translate('Password is too long')));\n  }\n  if ('markupText' === mode || 'editPost' === mode) {\n    return;\n  }\n  if ('createThread' === mode && this.maxFileCount && files.length <= 0) {\n    return Promise.reject(new Error(Tools.translate('Attempt to create a thread without attaching a file')));\n  }\n  if (text.length <= 0 && (files.length + existingFileCount) <= 0) {\n    return Promise.reject(new Error(Tools.translate('Both file and comment are missing')));\n  }\n  if ((files.length + existingFileCount) > this.maxFileCount) {\n    return Promise.reject(new Error(Tools.translate('Too many files')));\n  }\n  let err = files.reduce((err, file) => {\n    if (err) {\n      return err;\n    }\n    if (file.size > this.maxFileSize) {\n      return Tools.translate('File is too big');\n    }\n    if (this.supportedFileTypes.indexOf(file.mimeType) < 0) {\n      return Tools.translate('File type is not supported');\n    }\n  }, '');\n  if (err) {\n    return Promise.reject(err);\n  }\n};\n\nvar renderFileInfo = function(fi) {\n    fi.sizeKB = fi.size / 1024;\n    fi.sizeText = fi.sizeKB.toFixed(2) + \"KB\";\n    if (Tools.isImageType(fi.mimeType) || Tools.isVideoType(fi.mimeType)) {\n        if (fi.dimensions)\n            fi.sizeText += \", \" + fi.dimensions.width + \"x\" + fi.dimensions.height;\n    }\n    if (Tools.isAudioType(fi.mimeType) || Tools.isVideoType(fi.mimeType)) {\n        var ed = fi.extraData;\n        if (ed.duration)\n            fi.sizeText += \", \" + ed.duration;\n        if (Tools.isAudioType(fi.mimeType)) {\n            if (ed.bitrate)\n                fi.sizeText += \", \" + ed.bitrate + Tools.translate(\"kbps\", \"kbps\");\n            fi.sizeTooltip = ed.artist ? ed.artist : Tools.translate(\"Unknown artist\", \"unknownArtist\");\n            fi.sizeTooltip += \" - \";\n            fi.sizeTooltip += ed.title ? ed.title : Tools.translate(\"Unknown title\", \"unknownTitle\");\n            fi.sizeTooltip += \" [\";\n            fi.sizeTooltip += ed.album ? ed.album : Tools.translate(\"Unknown album\", \"unknownAlbum\");\n            fi.sizeTooltip += \"]\";\n            if (ed.year)\n                fi.sizeTooltip += \" (\" + ed.year + \")\";\n        } else if (Tools.isVideoType(fi.mimeType) && ed.bitrate) {\n            fi.sizeTooltip = ed.bitrate + Tools.translate(\"kbps\", \"kbps\");\n        }\n    }\n};\n\n/*public*/ Board.prototype.renderPost = function(post) {\n    (post.fileInfos || []).forEach(function(fileInfo) {\n        renderFileInfo(fileInfo);\n    });\n    post.rawSubject = post.subject;\n    post.isOp = (post.number == post.threadNumber);\n    if (post.options.showTripcode)\n        post.tripcode = Tools.generateTripcode(post.user.hashpass);\n    delete post.user.ip;\n    delete post.user.hashpass;\n    delete post.user.password;\n    if (!post.geolocation.countryName) {\n      post.geolocation.countryName = \"Unknown country\";\n    }\n    return Promise.resolve(post);\n};\n\nBoard.MarkupElements = {\n    BoldMarkupElement: \"BOLD\",\n    ItalicsMarkupElement: \"ITALICS\",\n    StrikedOutMarkupElement: \"STRIKED_OUT\",\n    UnderlinedMarkupElement: \"UNDERLINED\",\n    SpoilerMarkupElement: \"SPOILER\",\n    QuotationMarkupElement: \"QUOTATION\",\n    UnorderedList: \"UNORDERED_LIST\",\n    OrderedList: \"ORDERED_LIST\",\n    ListItem: \"LIST_ITEM\",\n    SubscriptMarkupElement: \"SUBSCRIPT\",\n    SuperscriptMarkupElement: \"SUPERSCRIPT\",\n    UrlMarkupElement: \"URL\",\n    CodeMarkupElement: \"CODE\",\n    LatexMarkupElement: \"LATEX\",\n    InlineLatexMarkupElement: \"INLINE_LATEX\"\n};\n\nBoard.MimeTypesForExtensions = {};\nBoard.DefaultExtensions = {};\n\nvar defineMimeTypeExtensions = function(mimeType) {\n    var extensions = Array.prototype.slice.call(arguments, 1);\n    extensions.forEach(function(extension) {\n        Board.MimeTypesForExtensions[extension] = mimeType;\n    });\n    Board.DefaultExtensions[mimeType] = extensions[0];\n};\n\ndefineMimeTypeExtensions(\"application/ogg\", \"ogg\");\ndefineMimeTypeExtensions(\"application/pdf\", \"pdf\");\ndefineMimeTypeExtensions(\"audio/mpeg\", \"mpeg\", \"mp1\", \"m1a\", \"mp3\", \"m2a\", \"mpa\", \"mpg\");\ndefineMimeTypeExtensions(\"audio/ogg\", \"ogg\");\ndefineMimeTypeExtensions(\"audio/wav\", \"wav\");\ndefineMimeTypeExtensions(\"image/gif\", \"gif\");\ndefineMimeTypeExtensions(\"image/jpeg\", \"jpeg\", \"jpg\");\ndefineMimeTypeExtensions(\"image/png\", \"png\");\ndefineMimeTypeExtensions(\"video/mp4\", \"mp4\");\ndefineMimeTypeExtensions(\"video/webm\", \"webm\");\n\nBoard.ThumbExtensionsForMimeType = {\n    \"application/ogg\": \"png\",\n    \"application/pdf\": \"png\",\n    \"audio/mpeg\": \"png\",\n    \"audio/ogg\": \"png\",\n    \"audio/wav\": \"png\",\n    \"video/mp4\": \"png\",\n    \"video/webm\": \"png\"\n};\n\nBoard.board = function(name) {\n    return Board.boards[name];\n};\n\nBoard.addBoard = function(board) {\n    if (!Board.prototype.isPrototypeOf(board))\n        return;\n    Board.boards[board.name] = board;\n};\n\nBoard.boardInfos = function(includeHidden) {\n    includeHidden = (includeHidden || (typeof includeHidden == \"undefined\"));\n    var list = [];\n    Tools.toArray(Board.boards).sort(function(b1, b2) {\n        return (b1.name < b2.name) ? -1 : 1;\n    }).forEach(function(board) {\n        if (!board.enabled || (!includeHidden && board.hidden))\n            return;\n        list.push({\n            name: board.name,\n            title: board.title\n        });\n    });\n    return list;\n};\n\nBoard.boardNames = function(includeHidden) {\n    includeHidden = (includeHidden || (typeof includeHidden == \"undefined\"));\n    var list = [];\n    Tools.toArray(Board.boards).sort(function(b1, b2) {\n        return (b1.name < b2.name) ? -1 : 1;\n    }).forEach(function(board) {\n        if (!board.enabled || (!includeHidden && board.hidden))\n            return;\n        list.push(board.name);\n    });\n    return list;\n};\n\nBoard.sortThreadsByDate = function(a, b) {\n    if (a.fixed == b.fixed) {\n        if (a.updatedAt < b.updatedAt)\n            return 1;\n        else if (a.updatedAt > b.updatedAt)\n            return -1;\n        else\n            return 0;\n    } else if (a.fixed) {\n        return -1;\n    } else {\n        return 1;\n    }\n};\n\nBoard.sortThreadsByCreationDate = function(a, b) {\n    if (a.createdAt > b.createdAt)\n        return -1;\n    else if (a.createdAt < b.createdAt)\n        return 1;\n    else\n        return 0;\n};\n\nBoard.sortThreadsByPostCount = function(a, b) {\n    if (a.postCount > b.postCount)\n        return -1;\n    else if (a.postCount < b.postCount)\n        return 1;\n    else\n        return 0;\n};\n\nvar getRules = function(boardName) {\n  var fileName = `${__dirname}/../misc/rules/rules${(boardName ? ('.' + boardName) : '')}.txt`;\n  try {\n    if (!FSSync.existsSync(fileName)) {\n      return [];\n    }\n    var data = FSSync.readFileSync(fileName, \"utf8\");\n    if (!data) {\n      return [];\n    }\n    return data.split(/\\r*\\n+/gi).filter(function(rule) {\n      return rule;\n    });\n  } catch (err) {\n    console.error(err);\n    return [];\n  }\n};\n\nBoard.initialize = function() {\n    Board.boards = {};\n\n    FSSync.readdirSync(__dirname).forEach(function(file) {\n        if (\"index.js\" == file || \"board.js\" == file || \"js\" != file.split(\".\").pop())\n            return;\n        var id = require.resolve(\"./\" + file.split(\".\").shift());\n        if (require.cache.hasOwnProperty(id))\n            delete require.cache[id];\n        var board = require(id);\n        if (Util.isArray(board)) {\n            board.forEach(function(board) {\n                Board.addBoard(board);\n            });\n        } else {\n            Board.addBoard(board);\n        }\n    });\n\n    if (config(\"board.useDefaultBoards\", true)) {\n        Board.addBoard(new Board(\"3dpd\", Tools.translate.noop(\"3D pron\", \"boardTitle\")));\n\n        Board.addBoard(new Board(\"a\", Tools.translate.noop(\"/a/nime\", \"boardTitle\"),\n            { defaultUserName: Tools.translate.noop(\"Kamina\", \"defaultUserName\") }));\n\n        Board.addBoard(new Board(\"b\", Tools.translate.noop(\"/b/rotherhood\", \"boardTitle\")));\n\n        Board.addBoard(new Board(\"cg\", Tools.translate.noop(\"Console games\", \"boardTitle\")));\n\n        Board.addBoard(new Board(\"d\", Tools.translate.noop(\"Board /d/iscussion\", \"boardTitle\")));\n        Board.addBoard(new Board(\"echo\", Tools.translate.noop(\"Boardsphere echo\", \"boardTitle\")));\n\n        Board.addBoard(new Board(\"h\", Tools.translate.noop(\"/h/entai\", \"boardTitle\")));\n\n        Board.addBoard(new Board(\"int\", \"/int/ernational\",\n            { defaultUserName: Tools.translate.noop(\"Vladimir Putin\", \"defaultUserName\") }));\n\n        Board.addBoard(new Board(\"mlp\", Tools.translate.noop(\"My Little Pony\", \"boardTitle\")));\n\n        Board.addBoard(new Board(\"po\", Tools.translate.noop(\"/po/litics\", \"boardTitle\"),\n            { defaultUserName: Tools.translate.noop(\"Armchair warrior\", \"defaultUserName\") }));\n\n        let board = new Board(\"pr\", Tools.translate.noop(\"/pr/ogramming\", \"boardTitle\"));\n        board.defineSetting(\"markupElements\", board.markupElements.concat(Board.MarkupElements.CodeMarkupElement,\n            Board.MarkupElements.LatexMarkupElement, Board.MarkupElements.InlineLatexMarkupElement));\n        Board.addBoard(board);\n\n        Board.addBoard(new Board(\"rf\", Tools.translate.noop(\"Refuge\", \"boardTitle\"),\n            { defaultUserName: Tools.translate.noop(\"Whiner\", \"defaultUserName\") }));\n\n        Board.addBoard(new Board(\"rpg\", Tools.translate.noop(\"Role-playing games\", \"boardTitle\")));\n        Board.addBoard(new Board(\"soc\", Tools.translate.noop(\"Social life\", \"boardTitle\"),\n            { defaultUserName: Tools.translate.noop(\"Life of the party\", \"defaultUserName\") }));\n\n        Board.addBoard(new Board(\"vg\", Tools.translate.noop(\"Video games\", \"boardTitle\"),\n            { defaultUserName: Tools.translate.noop(\"PC Nobleman\", \"defaultUserName\") }));\n    }\n\n    Board._banners = {};\n    Board.boardNames().forEach(function(boardName) {\n        var path = __dirname + \"/../public/img/banners/\" + boardName;\n        if (FSSync.existsSync(path)) {\n            Board._banners[boardName] = FSSync.readdirSync(path).filter(function(fileName) {\n                return \".gitignore\" != fileName;\n            });\n        } else {\n            Board._banners[boardName] = [];\n        }\n    });\n\n  Board._postFormRules = {};\n  Board.boardNames().forEach(function(boardName) {\n    var common = getRules();\n    var specific = getRules(boardName);\n    for (var i = specific.length - 1; i >= 0; --i) {\n      var rule = specific[i];\n      var rxExcept = /^#include\\s+except(\\((\\d+(\\,\\d+)*)\\))$/;\n      var rxSeveral = /^#include\\s+(\\d+(\\,\\d+)*)$/;\n      if ('#include all' === rule) {\n        Array.prototype.splice.apply(specific, [i, 1].concat(common));\n      } else if (rxExcept.test(rule)) {\n        var excluded = rule.match(rxExcept)[2].split(\",\").map(function(n) {\n          return +n;\n        });\n        Array.prototype.splice.apply(specific, [i, 1].concat(common.filter(function(_, i) {\n          return excluded.indexOf(i) < 0;\n        })));\n      } else if (rxSeveral.test(rule)) {\n        var included = rule.match(rxSeveral)[1].split(\",\").map(function(n) {\n          return +n;\n        }).filter(function(n) {\n          return n >= 0 && n < common.length;\n        }).map(function(n) {\n          return common[n];\n        });\n        Array.prototype.splice.apply(specific, [i, 1].concat(included));\n      }\n    };\n    Board._postFormRules[boardName] = (specific.length > 0) ? specific : common;\n  });\n};\n\nexport default Board;\n\n//var Database = require(\"../helpers/database\");\n"],"sourceRoot":"/source/"}