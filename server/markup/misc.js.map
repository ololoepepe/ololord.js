{"version":3,"sources":["markup/misc.js"],"names":["Renderer","Tools","convertHtml","_1","text","_2","_3","options","type","HTML_SKIP","convertEmDash","_4","NO_SKIP","convertEnDash","convertCSpoiler","matchs","title","translate","toHTML","op","cl","convertTooltip","tooltip","convertCitation","matche","checkCitationNotInterrupted","info","isIn","index","substr","priority","markupModes","convert","permission","nestable","check"],"mappings":"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","file":"misc.js","sourcesContent":["import ProcessingContext from './processing-context';\nimport * as Renderer from '../core/renderer';\nimport * as Tools from '../helpers/tools';\n\nfunction convertHtml(_1, text, _2, _3, options) {\n  options.type = ProcessingContext.HTML_SKIP;\n  return text;\n}\n\nfunction convertEmDash(_1, _2, _3, _4, options) {\n  options.type = ProcessingContext.NO_SKIP;\n  return '\\u2014';\n}\n\nfunction convertEnDash(_1, _2, _3, _4, options) {\n  options.type = ProcessingContext.NO_SKIP;\n  return '\\u2013';\n}\n\nfunction convertCSpoiler(_1, text, matchs, _2, options) {\n  let title = matchs[1];\n  if (!title) {\n    title = Tools.translate('Spoiler');\n  }\n  title = Renderer.toHTML(title);\n  options.type = ProcessingContext.NO_SKIP;\n  options.op = \"<span class='collapsible-spoiler'><span class='collapsible-spoiler-title' \"\n    + `title='${Tools.translate('Spoiler')}' onclick='lord.expandCollapseSpoiler(this);'>${title}`\n    + \"</span><span class='collapsible-spoiler-body' style='display: none;'>\";\n  options.cl = '</span></span>';\n  return text;\n}\n\nfunction convertTooltip(_1, text, matchs, _2, options) {\n  let tooltip = Renderer.toHTML(matchs[1]);\n  options.type = ProcessingContext.NO_SKIP;\n  options.op = `<span class='tooltip js-with-tooltip' title='${tooltip}'>`;\n  options.cl = '</span>';\n  return text;\n}\n\nfunction convertCitation(_1, text, matchs, matche, options) {\n  options.type = ProcessingContext.NO_SKIP;\n  if ('\\n' === matchs[1]) {\n    options.op = '<br />';\n  }\n  options.op += \"<span class='quotation'>&gt;\";\n  options.cl = '</span>';\n  if ('\\n' === matche[0]) {\n    options.cl += '<br />';\n  }\n  return text;\n}\n\nfunction checkCitationNotInterrupted(info, matchs, matche) {\n  if (info.isIn(matchs.index, matche.index - matchs.index)) {\n    return false;\n  }\n  if (0 === matchs.index) {\n    return true;\n  }\n  if ('\\n' === info.text.substr(matchs.index - 1, 1)) {\n    return true;\n  }\n  return info.isIn(matchs.index - 6, 6, ProcessingContext.HTML_SKIP)\n    && (info.text.substr(matchs.index - 6, 6) === '<br />');\n}\n\nexport default [{\n  priority: 600,\n  markupModes: ['BB_CODE'],\n  convert: convertHtml,\n  op: '[raw-html]',\n  cl: '[/raw-html]',\n  permission: 'useRawHTMLMarkup'\n}, {\n  priority: 2400,\n  markupModes: ['EXTENDED_WAKABA_MARK', 'BB_CODE'],\n  convert: convertEmDash,\n  op: '----',\n  cl: null\n}, {\n  priority: 2600,\n  markupModes: ['EXTENDED_WAKABA_MARK', 'BB_CODE'],\n  convert: convertEnDash,\n  op: '--',\n  cl: null\n}, {\n  priority: 4300,\n  markupModes: ['BB_CODE'],\n  convert: convertCSpoiler,\n  op: '[cspoiler]',\n  cl: '[/cspoiler]',\n  nestable: true\n}, {\n  priority: 4400,\n  markupModes: ['BB_CODE'],\n  convert: convertCSpoiler,\n  op: /\\[cspoiler\\s+title=['\"]([^\"]*)['\"]\\s*\\]/gi,\n  cl: '[/cspoiler]',\n  nestable: true\n}, {\n  priority: 4500,\n  markupModes: ['BB_CODE'],\n  convert: convertTooltip,\n  op: /\\[tooltip\\s+value=['\"]([^\"]*)['\"]\\s*\\]/gi,\n  cl: '[/tooltip]',\n  nestable: true\n}, {\n  priority: 4900,\n  markupModes: ['EXTENDED_WAKABA_MARK', 'BB_CODE'],\n  convert: convertCitation,\n  op: '>',\n  cl: /\\n|$/gi,\n  check: checkCitationNotInterrupted\n}];\n"]}