{"version":3,"sources":["markup/links.js"],"names":[],"mappings":"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","file":"markup/links.js","sourcesContent":["import HTTP from 'q-io/http';\nimport URL from 'url';\nimport XRegExp from 'xregexp';\n\nimport ProcessingContext from './processing-context';\nimport Board from '../boards/board';\nimport * as Renderer from '../core/renderer';\nimport config from '../helpers/config';\nimport FSWatcher from '../helpers/fs-watcher';\nimport Logger from '../helpers/logger';\nimport * as Tools from '../helpers/tools';\nimport * as PostsModel from '../models/posts';\n\nconst EXTERNAL_LINK_REGEXP_PATTERN = (() => {\n  let schema = 'https?:\\\\/\\\\/|ftp:\\\\/\\\\/';\n  let ip = '(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}'\n    + '(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])';\n  let hostname = '([\\\\w\\\\p{L}\\\\.\\\\-]+)\\\\.([\\\\p{L}]{2,17}\\\\.?)';\n  let port = ':\\\\d+';\n  let path = '(\\\\/[\\\\w\\\\p{L}\\\\.\\\\-\\\\!\\\\?\\\\=\\\\+#~&%:;\\'\\\"\\\\,\\\\(\\\\)\\\\[\\\\]«»]*)*\\\\/?';\n  return `(${schema})?(${hostname}|${ip})(${port})?${path}`;\n})();\nconst RX_VK_POST_LINK_PATTERN = '<div id\\\\=\"vk_post_\\\\-?\\\\d+_\\\\d+\"><\\\\/div><script type=\"text\\\\/javascript\">  '\n  + '\\\\(function\\\\(d\\\\, s\\\\, id\\\\) \\\\{ var js\\\\, fjs \\\\= d\\\\.getElementsByTagName\\\\(s\\\\)\\\\[0\\\\]; '\n  + 'if \\\\(d\\\\.getElementById\\\\(id\\\\)\\\\) return; js \\\\= d\\\\.createElement\\\\(s\\\\); js\\\\.id \\\\= id; js\\\\.src \\\\= '\n  + '\"\\\\/\\\\/vk\\\\.com\\\\/js\\\\/api\\\\/openapi\\\\.js\\\\?121\"; fjs\\\\.parentNode\\\\.insertBefore\\\\(js\\\\, fjs\\\\); '\n  + '\\\\}\\\\(document\\\\, \\'script\\'\\\\, \\'vk_openapi_js\\'\\\\)\\\\);  \\\\(function\\\\(\\\\) \\\\{    if \\\\(\\\\!window\\\\.VK \\\\|\\\\|'\n  + ' \\\\!VK\\\\.Widgets \\\\|\\\\| \\\\!VK\\\\.Widgets\\\\.Post \\\\|\\\\| \\\\!VK\\\\.Widgets\\\\.Post\\\\(\"vk_post_\\\\-?\\\\d+_\\\\d+\"\\\\, '\n  + '(\\\\-?\\\\d+)\\, (\\\\d+)\\, \\'([a-zA-Z0-9_\\-]+)\\'\\\\, \\\\{width\\\\: 500\\\\}\\\\)\\\\) '\n  + 'setTimeout\\\\(arguments\\\\.callee\\\\, 50\\\\);  \\\\}\\\\(\\\\)\\\\);<\\\\/script>';\nconst RX_VK_POST_LINK = new RegExp(RX_VK_POST_LINK_PATTERN, 'g');\nconst RX_TWITTER_POST_LINK = /^https?\\:\\/\\/twitter\\.com\\/[^\\/]+\\/status\\/\\d+\\/?$/;\nconst RX_YOUTUBE_VIDEO_LINK_1 = /^https?\\:\\/\\/(m\\.|www\\.)?youtube\\.com\\/.*v\\=([^\\/#\\?&]+).*$/;\nconst RX_YOUTUBE_VIDEO_LINK_2 = /^https?\\:\\/\\/youtu\\.be\\/([^\\/#\\?]+).*$/;\nconst RX_COUB_VIDEO_LINK = /^https?:\\/\\/coub\\.com\\/view\\/([^\\/\\?#]+).*$/;\nconst RX_VOCAROO_AUDIO_LINK = /^https?:\\/\\/vocaroo\\.com\\/i\\/([a-zA-Z0-9]+)$/;\n\nfunction transformRootZones(zones) {\n  return zones.reduce((acc, zone) => {\n    acc[zone] = true;\n    return acc;\n  }, {});\n}\n\nlet rootZones = FSWatcher.createWatchedResource(`${__dirname}/../../misc/root-zones.json`, (path) => {\n  return transformRootZones(require(path));\n}, async function(path) {\n  return transformRootZones(require(path));\n}) || {};\n\nfunction youtubeVideoStartTime(href) {\n  if (!href) {\n    return null;\n  }\n  let time = URL.parse(href, true).query.t;\n  if (!time) {\n    return null;\n  }\n  let match = time.match(/((\\d+)h)?((\\d+)m)?((\\d+)s)?/);\n  if (!match) {\n    return null;\n  }\n  let start = 0;\n  if (match[2]) {\n    start += +match[2] * 3600; //NOTE: Hours\n  }\n  if (match[4]) {\n    start += +match[4] * 60; //NOTE: Minutes\n  }\n  if (match[6]) {\n    start += +match[6]; //NOTE: Seconds\n  }\n  return Tools.option(start, 'number', null, { test: (s) => { return s > 0; } });\n}\n\nasync function getTwitterEmbeddedHtml(href, defaultHTML) {\n  try {\n    let response = await HTTP.request({\n      method: 'GET',\n      url: `https://api.twitter.com/1/statuses/oembed.json?url=${href}`,\n      timeout: config('system.httpRequestTimeout')\n    });\n    if (response.status !== 200) {\n      throw new Error(Tools.translate('Failed to get Twitter embedded HTML'));\n    }\n    let data = await response.body.read();\n    return JSON.parse(data.toString()).html;\n  } catch (err) {\n    Logger.error(err.stack || err);\n    return defaultHTML;\n  }\n}\n\nasync function getYoutubeEmbeddedHtml(href, defaultHTML) {\n  let match = href.match(RX_YOUTUBE_VIDEO_LINK_1);\n  let videoId = match ? match[2] : null;\n  if (!videoId) {\n    match = href.match(RX_YOUTUBE_VIDEO_LINK_2);\n    videoId = match ? match[1] : null;\n  }\n  let apiKey = config('server.youtubeApiKey');\n  if (!videoId || !apiKey) {\n    return defaultHTML;\n  }\n  try {\n    let response = await HTTP.request({\n      method: 'GET',\n      url: `https://www.googleapis.com/youtube/v3/videos?id=${videoId}&key=${apiKey}&part=snippet`,\n      timeout: config('system.httpRequestTimeout')\n    });\n    if (response.status !== 200) {\n      throw new Error(Tools.translate('Failed to get YouTube embedded HTML'));\n    }\n    let data = await response.body.read();\n    response = JSON.parse(data.toString());\n    if (!response.items || response.items.length < 1) {\n      throw new Error(Tools.translate('Failed to get YouTube video info'));\n    }\n    let info = response.items[0].snippet;\n    info.id = videoId;\n    info.href = href;\n    info.start = youtubeVideoStartTime(href);\n    let html = Renderer.render('markup/youtubeVideoLink', { info: info });\n    if (!html) {\n      throw new Error(Tools.translate('Failed to create YouTube video link'));\n    }\n    return html;\n  } catch (err) {\n    Logger.error(err.stack || err);\n    return defaultHTML;\n  }\n}\n\nasync function getCoubEmbeddedHtml(href, defaultHTML) {\n  let match = href.match(RX_COUB_VIDEO_LINK);\n  let videoId = match ? match[1] : null;\n  if (!videoId) {\n    return defaultHTML;\n  }\n  try {\n    let response = await HTTP.request({\n      method: 'GET',\n      url: `https://coub.com/api/oembed.json?url=http://coub.com/view/${videoId}`,\n      timeout: config('system.httpRequestTimeout')\n    });\n    if (response.status !== 200) {\n      throw new Error(Tools.translate('Failed to get Coub embedded HTML'));\n    }\n    let data = await response.body.read();\n    response = JSON.parse(data.toString());\n    if (!response) {\n      throw new Error(Tools.translate('Failed to get Coub video info'));\n    }\n    let info = {\n      href: href,\n      videoTitle: response.title,\n      authorName: response.author_name,\n      thumbnail: response.thumbnail_url ? {\n        url: response.thumbnail_url,\n        width: response.thumbnail_width,\n        height: response.thumbnail_height\n      } : null,\n      id: videoId\n    };\n    let html = Renderer.render('markup/coubVideoLink', { info: info });\n    if (!html) {\n      throw new Error(Tools.translate('Failed to create Coub video link'));\n    }\n    return html;\n  } catch (err) {\n    Logger.error(err.stack || err);\n    return defaultHTML;\n  }\n}\n\nfunction getVocarooEmbeddedHtml(href, defaultHTML) {\n  let match = href.match(RX_VOCAROO_AUDIO_LINK);\n  let audioId = match ? match[1] : null;\n  if (!audioId) {\n    return defaultHTML;\n  }\n  try {\n    let html = Renderer.render('markup/vocarooAudioLink', { info: { id: audioId } });\n    if (!html) {\n      throw new Error(Tools.translate('Failed to create Vocaroo audio embedded container'));\n    }\n    return html;\n  } catch (err) {\n    Logger.log(err.stack || err);\n    return defaultHTML;\n  }\n}\n\nfunction convertVkontaktePost(_1, _2, matchs, _3, options) {\n  options.type = ProcessingContext.HTML_SKIP;\n  return `<div class='overflow-x-container'>${matchs[0]}</div>`;\n}\n\nasync function convertLinkCommon(hrefIsText, info, text, matchs, _1, options) {\n  if (!text) {\n    return '';\n  }\n  options.type = ProcessingContext.HTML_SKIP;\n  if (info.isIn(matchs.index, matchs[0].length, ProcessingContext.HTML_SKIP)) {\n    return text;\n  }\n  if (!hrefIsText) {\n    text = matchs[0];\n  }\n  let href = text;\n  if (href.lastIndexOf('http', 0) && href.lastIndexOf('ftp', 0)) {\n    href = `http://${href}`;\n  }\n  let defaultHTML = `<a href='${href}'>${Renderer.toHTML(text)}</a>`;\n  if (config('site.twitter.integrationEnabled') && RX_TWITTER_POST_LINK.test(href)) {\n    return await getTwitterEmbeddedHtml(href, defaultHTML);\n  }\n  if (RX_YOUTUBE_VIDEO_LINK_1.test(href) || RX_YOUTUBE_VIDEO_LINK_2.test(href)) {\n    return await getYoutubeEmbeddedHtml(href, defaultHTML);\n  }\n  if (RX_COUB_VIDEO_LINK.test(href)) {\n    return await getCoubEmbeddedHtml(href, defaultHTML);\n  }\n  if (RX_VOCAROO_AUDIO_LINK.test(href)) {\n    return getVocarooEmbeddedHtml(href, defaultHTML);\n  }\n  return defaultHTML;\n}\n\nfunction convertProtocol(_1, _2, matchs, _3, options) {\n  options.type = ProcessingContext.HTML_SKIP;\n  return `<a href='${matchs[0]}'>${Renderer.toHTML(matchs[2])}</a>`;\n}\n\nasync function convertPostLink(info, _1, matchs, _2, options) {\n  options.type = ProcessingContext.HTML_SKIP;\n  let boardName = (matchs.length > 2) ? matchs[1] : info.boardName;\n  let postNumber = Tools.option(matchs[(matchs.length > 2) ? 2 : 1], 'number', 0, { test: Tools.testPostNumber });\n  let escaped = matchs[0].split('>').join('&gt;');\n  if (!postNumber || postNumber === info.deletedPost) {\n    return escaped;\n  }\n  let post = await PostsModel.getPost(boardName, postNumber);\n  if (!post) {\n    return escaped;\n  }\n  if (info.referencedPosts) {\n    let key = `${boardName}:${postNumber}`;\n    if (!info.referencedPosts[key]) {\n      info.referencedPosts[key] = {\n        boardName: boardName,\n        postNumber: postNumber,\n        threadNumber: post.threadNumber,\n        createdAt: Tools.now()\n      };\n    }\n  }\n  let result = `<a href='/${config('site.pathPrefix')}${boardName}/res/${post.threadNumber}.html`;\n  if (postNumber !== post.threadNumber) {\n    result += `#post-${postNumber}`;\n  }\n  result += \"' class='js-post-link\";\n  if (postNumber === post.threadNumber) {\n    result += \" op-post-link\";\n  }\n  result += `' data-board-name='${boardName}' data-post-number='${postNumber}'`;\n  result += ` data-thread-number='${post.threadNumber}'>${escaped}</a>`;\n  return result;\n}\n\nfunction checkExternalLink(info, matchs) {\n  if (matchs.index > 0 && ['@', '#'].indexOf(info.text[matchs.index - 1]) >= 0) {\n    return false;\n  }\n  return /^\\d+\\.\\d+\\.\\d+\\.\\d+$/.test(matchs[2]) || rootZones.hasOwnProperty(matchs[4]);\n}\n\nfunction checkPostLink(_1, matchs) {\n  return Board.boardNames().indexOf(matchs[1]) >= 0;\n}\n\nexport default [{\n  priority: 1500,\n  markupModes: ['EXTENDED_WAKABA_MARK', 'BB_CODE'],\n  convert: convertVkontaktePost,\n  op: RX_VK_POST_LINK,\n  cl: null,\n  enabled: () => { return config('site.vkontakte.integrationEnabled'); }\n}, {\n  priority: 1600,\n  markupModes: ['EXTENDED_WAKABA_MARK', 'BB_CODE'],\n  convert: convertLinkCommon.bind(null, true),\n  op: '[url]',\n  cl: '[/url]'\n}, {\n  priority: 1700,\n  markupModes: ['EXTENDED_WAKABA_MARK', 'BB_CODE'],\n  convert: convertLinkCommon.bind(null, false),\n  op: new XRegExp(EXTERNAL_LINK_REGEXP_PATTERN, 'gi'),\n  cl: null,\n  check: checkExternalLink\n}, {\n  priority: 1800,\n  markupModes: ['EXTENDED_WAKABA_MARK', 'BB_CODE'],\n  convert: convertProtocol,\n  op: /(mailto|irc|news)\\:(\\S+)/gi,\n  cl: null\n}, {\n  priority: 2200,\n  markupModes: ['EXTENDED_WAKABA_MARK', 'BB_CODE'],\n  convert: convertPostLink,\n  op: />>([1-9][0-9]*)/gi,\n  cl: null\n}, {\n  priority: 2300,\n  markupModes: ['EXTENDED_WAKABA_MARK', 'BB_CODE'],\n  convert: convertPostLink,\n  op: new RegExp(`>>/([^\\/\\s]+)/([1-9][0-9]*)`, 'gi'),\n  cl: null,\n  check: checkPostLink\n}];\n"],"sourceRoot":"/source/"}