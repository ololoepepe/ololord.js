{"version":3,"sources":["storage/ordered-set.js"],"names":["OrderedSet","args","lb","ub","subkey","client","zrange","fullKey","data","map","parse","zrangebyscore","score","zadd","stringify","list","isArray","length","some","item","call","flatten","zrem","zcard"],"mappings":";;;;;;;;;;AAAA;;;;AAEA;;;;;;;;;;;;;;;;IAEqBA,U;;;AACnB,wBAAqB;AAAA;;AAAA;;AAAA,sCAANC,IAAM;AAANA,UAAM;AAAA;;AAAA,8IACVA,IADU;AAEpB;;;;;6EAEaC,E,EAAIC,E,EAAIC,M;;;;;;;uBACH,KAAKC,MAAL,CAAYC,MAAZ,CAAmB,KAAKC,OAAL,CAAaH,MAAb,CAAnB,EAAyCF,EAAzC,EAA6CC,EAA7C,C;;;AAAbK,oB;iDACGA,KAAKC,GAAL,CAAS,KAAKC,KAAd,C;;;;;;;;;;;;;;;;;;;8EAGYR,E,EAAIC,E,EAAIC,M;;;;;;;uBACV,KAAKC,MAAL,CAAYM,aAAZ,CAA0B,KAAKJ,OAAL,CAAaH,MAAb,CAA1B,EAAgDF,EAAhD,EAAoDC,EAApD,C;;;AAAbK,oB;kDACGA,KAAKC,GAAL,CAAS,KAAKC,KAAd,C;;;;;;;;;;;;;;;;;;;8EAGIN,M;;;;;;;uBACM,KAAKC,MAAL,CAAYC,MAAZ,CAAmB,KAAKC,OAAL,CAAaH,MAAb,CAAnB,EAAyC,CAAzC,EAA4C,CAAC,CAA7C,C;;;AAAbI,oB;kDACGA,KAAKC,GAAL,CAAS,KAAKC,KAAd,C;;;;;;;;;;;;;;;;;;;8EAGIF,I,EAAMI,K,EAAOR,M;;;;;;uBACX,KAAKC,MAAL,CAAYQ,IAAZ,CAAiB,KAAKN,OAAL,CAAaH,MAAb,CAAjB,EAAuCQ,KAAvC,EAA8C,KAAKE,SAAL,CAAeN,IAAf,CAA9C,C;;;;;;;;;;;;;;;;;;;;;;8EAGDO,I,EAAMX,M;;;;;;;;sBACd,CAACW,IAAD,IAAS,CAAC,0BAAEA,IAAF,EAAQC,OAAR,EAAV,IAA+BD,KAAKE,MAAL,IAAe,CAA9C,IAAmDF,KAAKG,IAAL,CAAU,UAACC,IAAD,EAAU;AAAE,yBAAO,QAAOA,IAAP,yCAAOA,IAAP,OAAgB,QAAvB;AAAkC,iBAAxD,C;;;;;kDAC9C,C;;;;uBAEI,qBAAKd,MAAL,CAAYQ,IAAZ,EAAiBO,IAAjB,sBAAsB,KAAKf,MAA3B,EAAmC,KAAKE,OAAL,CAAaH,MAAb,CAAnC,4BACR,0BAAEW,KAAKN,GAAL,CAAS;AAAA,yBAAQ,CAACU,KAAKP,KAAN,EAAa,OAAKE,SAAL,CAAeK,KAAKX,IAApB,CAAb,CAAR;AAAA,iBAAT,CAAF,EAA6Da,OAA7D,EADQ,G;;;;;;;;;;;;;;;;;;;;;;8EAICb,I,EAAMJ,M;;;;;;uBACP,KAAKC,MAAL,CAAYiB,IAAZ,CAAiB,KAAKf,OAAL,CAAaH,MAAb,CAAjB,EAAuC,KAAKU,SAAL,CAAeN,IAAf,CAAvC,C;;;;;;;;;;;;;;;;;;;;;;8EAGEO,I,EAAMX,M;;;;;;;sBACjB,CAACW,IAAD,IAAS,CAAC,0BAAEA,IAAF,EAAQC,OAAR,EAAV,IAA+BD,KAAKE,MAAL,IAAe,C;;;;;kDACzC,C;;;;uBAEI,qBAAKZ,MAAL,CAAYiB,IAAZ,EAAiBF,IAAjB,sBAAsB,KAAKf,MAA3B,EAAmC,KAAKE,OAAL,CAAaH,MAAb,CAAnC,4BAA4DW,KAAKN,GAAL,CAAS,KAAKK,SAAd,CAA5D,G;;;;;;;;;;;;;;;;;;;;;;8EAGHV,M;;;;;;uBACG,KAAKC,MAAL,CAAYkB,KAAZ,CAAkB,KAAKhB,OAAL,CAAaH,MAAb,CAAlB,C;;;;;;;;;;;;;;;;;;;;;;;;kBA5CIJ,U","file":"ordered-set.js","sourcesContent":["import _ from 'underscore';\n\nimport CommonKey from './common-key';\n\nexport default class OrderedSet extends CommonKey {\n  constructor(...args) {\n    super(...args);\n  }\n\n  async getSome(lb, ub, subkey) {\n    let data = await this.client.zrange(this.fullKey(subkey), lb, ub);\n    return data.map(this.parse);\n  }\n\n  async getSomeByScore(lb, ub, subkey) {\n    let data = await this.client.zrangebyscore(this.fullKey(subkey), lb, ub);\n    return data.map(this.parse);\n  }\n\n  async getAll(subkey) {\n    let data = await this.client.zrange(this.fullKey(subkey), 0, -1);\n    return data.map(this.parse);\n  }\n\n  async addOne(data, score, subkey) {\n    return await this.client.zadd(this.fullKey(subkey), score, this.stringify(data));\n  }\n\n  async addSome(list, subkey) {\n    if (!list || !_(list).isArray() || list.length <= 0 || list.some((item) => { return typeof item !== 'object'; })) {\n      return 0;\n    }\n    return await this.client.zadd.call(this.client, this.fullKey(subkey),\n      ..._(list.map(item => [item.score, this.stringify(item.data)])).flatten());\n  }\n\n  async removeOne(data, subkey) {\n    return await this.client.zrem(this.fullKey(subkey), this.stringify(data));\n  }\n\n  async removeSome(list, subkey) {\n    if (!list || !_(list).isArray() || list.length <= 0) {\n      return 0;\n    }\n    return await this.client.zrem.call(this.client, this.fullKey(subkey), ...list.map(this.stringify));\n  }\n\n  async count(subkey) {\n    return await this.client.zcard(this.fullKey(subkey));\n  }\n}\n"]}