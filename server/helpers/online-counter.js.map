{"version":3,"sources":["helpers/online-counter.js"],"names":["alive","unique","clear","users","Map","quota","interval","setInterval","forEach","q","ip","set","delete","o","keys"],"mappings":";;;;;QAiBgBA,K,GAAAA,K;QAIAC,M,GAAAA,M;QAQAC,K,GAAAA,K;;AA7BhB;;;;;;AAEA,IAAIC,QAAQ,IAAIC,GAAJ,EAAZ;AACA,IAAIC,QAAQ,sBAAO,4BAAP,CAAZ;AACA,IAAIC,WAAW,sBAAO,+BAAP,CAAf;;AAEAC,YAAY,YAAM;AAChBJ,QAAMK,OAAN,CAAc,UAACC,CAAD,EAAIC,EAAJ,EAAW;AACvBD,SAAKH,QAAL;AACA,QAAIG,IAAI,CAAR,EAAW;AACTN,YAAMQ,GAAN,CAAUD,EAAV,EAAcD,CAAd;AACD,KAFD,MAEO;AACLN,YAAMS,MAAN,CAAaF,EAAb;AACD;AACF,GAPD;AAQD,CATD,EASGJ,QATH;;AAWO,SAASN,KAAT,CAAeU,EAAf,EAAmB;AACxBP,QAAMQ,GAAN,CAAUD,EAAV,EAAcL,KAAd;AACD;;AAEM,SAASJ,MAAT,GAAkB;AACvB,MAAIY,IAAI,EAAR;AADuB;AAAA;AAAA;;AAAA;AAEvB,yBAAeV,MAAMW,IAAN,EAAf,8HAA6B;AAAA,UAApBJ,EAAoB;;AAC3BG,QAAEH,EAAF,IAAQ,CAAR;AACD;AAJsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAKvB,SAAOG,CAAP;AACD;;AAEM,SAASX,KAAT,GAAiB;AACtBC,QAAMD,KAAN;AACD","file":"online-counter.js","sourcesContent":["import config from '../helpers/config';\n\nlet users = new Map();\nlet quota = config('system.onlineCounter.quota');\nlet interval = config('system.onlineCounter.interval');\n\nsetInterval(() => {\n  users.forEach((q, ip) => {\n    q -= interval;\n    if (q > 0) {\n      users.set(ip, q);\n    } else {\n      users.delete(ip);\n    }\n  });\n}, interval);\n\nexport function alive(ip) {\n  users.set(ip, quota);\n}\n\nexport function unique() {\n  let o = {};\n  for (let ip of users.keys()) {\n    o[ip] = 1;\n  }\n  return o;\n}\n\nexport function clear() {\n  users.clear();\n}\n"]}