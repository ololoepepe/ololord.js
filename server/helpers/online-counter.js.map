{"version":3,"sources":["helpers/online-counter.js"],"names":[],"mappings":";;;;;QAiBgB,K,GAAA,K;QAIA,M,GAAA,M;QAQA,K,GAAA,K;;AA7BhB;;;;;;AAEA,IAAI,QAAQ,IAAI,GAAJ,EAAZ;AACA,IAAI,QAAQ,sBAAO,4BAAP,CAAZ;AACA,IAAI,WAAW,sBAAO,+BAAP,CAAf;;AAEA,YAAY,YAAM;AAChB,QAAM,OAAN,CAAc,UAAC,CAAD,EAAI,EAAJ,EAAW;AACvB,SAAK,QAAL;AACA,QAAI,IAAI,CAAR,EAAW;AACT,YAAM,GAAN,CAAU,EAAV,EAAc,CAAd;AACD,KAFD,MAEO;AACL,YAAM,MAAN,CAAa,EAAb;AACD;AACF,GAPD;AAQD,CATD,EASG,QATH;;AAWO,SAAS,KAAT,CAAe,EAAf,EAAmB;AACxB,QAAM,GAAN,CAAU,EAAV,EAAc,KAAd;AACD;;AAEM,SAAS,MAAT,GAAkB;AACvB,MAAI,IAAI,EAAR;AADuB;AAAA;AAAA;;AAAA;AAEvB,yBAAe,MAAM,IAAN,EAAf,8HAA6B;AAAA,UAApB,EAAoB;;AAC3B,QAAE,EAAF,IAAQ,CAAR;AACD;AAJsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAKvB,SAAO,CAAP;AACD;;AAEM,SAAS,KAAT,GAAiB;AACtB,QAAM,KAAN;AACD","file":"helpers/online-counter.js","sourcesContent":["import config from '../helpers/config';\n\nlet users = new Map();\nlet quota = config('system.onlineCounter.quota');\nlet interval = config('system.onlineCounter.interval');\n\nsetInterval(() => {\n  users.forEach((q, ip) => {\n    q -= interval;\n    if (q > 0) {\n      users.set(ip, q);\n    } else {\n      users.delete(ip);\n    }\n  });\n}, interval);\n\nexport function alive(ip) {\n  users.set(ip, quota);\n}\n\nexport function unique() {\n  let o = {};\n  for (let ip of users.keys()) {\n    o[ip] = 1;\n  }\n  return o;\n}\n\nexport function clear() {\n  users.clear();\n}\n"],"sourceRoot":"/source/"}