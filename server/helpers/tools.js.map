{"version":3,"sources":["helpers/tools.js"],"names":["arr","f","container","isArray","isObject","p","Promise","resolve","forEach","el","index","then","result","push","each","key","series","now","mayBeHashpass","correctAddress","binaryAddress","subnet","preferIPv4","crypto","sha1","ipList","option","testPostNumber","cloned","addIPv4","compareRegisteredUserLevels","requireWrapper","loadPlugins","toHashpass","processError","pad","chunk","escapeRegExp","create404Error","translate","require","locale","extraLocations","__dirname","silent","on","setLocale","NON_THEME_STYLESHEETS","Set","reduce","acc","prefix","concat","map","suffix","STYLES_PATH","CODE_STYLES_PATH","JS_TYPES","IP_V6_MAX_SUBNET","IP_V4_MAX_SUBNET","SECOND","MINUTE","HOUR","DAY","FILE_RATINGS","NODE_CAPTCHA_ID","REGISTERED_USER_LEVELS","BAN_LEVELS","STYLES","readdirSync","filter","fileName","split","pop","has","shift","name","slice","join","match","exec","readFileSync","title","CODE_STYLES","Date","password","ip","replace","address","isValid","correctForm","err","fromAddress4","Buffer","from","toUnsignedByteArray","s","isNaN","ns","possibleSubnets","start","startAddress","end","endAddress","ipv4","to4","algorithm","data","encoding","isBuffer","hash","createHash","update","digest","arguments","ips","some","returntranslate","uniq","source","acceptable","def","strict","invert","test","converted","accepted","a","isRegExp","postNumber","value","val","recursive","object","l1","l2","indexOf","m","default","paths","keepCache","list","path","pathIndex","fileNames","id","cache","hasOwnProperty","plugins","flatten","notHashpass","dir","code","status","Error","Tools","what","length","ch","l","Array","toString","array","size","res","item","text","baseUrl"],"mappings":"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","file":"tools.js","sourcesContent":["import _ from 'underscore';\nimport { Address4, Address6 } from 'ip-address';\nimport Crypto from 'crypto';\nimport FSSync from 'fs';\nimport merge from 'merge';\nimport Util from 'util';\n\nimport config from './config';\n\nlet translate = require('cute-localize')({\n  locale: config('site.locale'),\n  extraLocations: `${__dirname}/../../translations/custom`,\n  silent: true\n});\n\nconfig.on('site.locale', (locale) => { translate.setLocale(locale); });\n\nexport { translate as translate };\n\nconst NON_THEME_STYLESHEETS = new Set(['', 'custom-'].reduce((acc, prefix) => {\n  return acc.concat(['combined', 'desktop', 'mobile'].map(suffix => `${prefix}base-${suffix}`));\n}, []));\nconst STYLES_PATH = `${__dirname}/../../public/css`;\nconst CODE_STYLES_PATH = `${__dirname}/../../public/css/3rdparty/highlight.js`;\nconst JS_TYPES = new Set(['string', 'boolean', 'number', 'object']);\nconst IP_V6_MAX_SUBNET = 128;\nconst IP_V4_MAX_SUBNET = 32;\n\nexport const SECOND = 1000;\nexport const MINUTE = 60 * SECOND;\nexport const HOUR = 60 * MINUTE;\nexport const DAY = 24 * HOUR;\nexport const FILE_RATINGS = ['SFW', 'R-15', 'R-18', 'R-18G'];\nexport const NODE_CAPTCHA_ID = 'node-captcha';\nexport const REGISTERED_USER_LEVELS = ['USER', 'MODER', 'ADMIN', 'SUPERUSER'];\nexport const BAN_LEVELS = ['NONE', 'READ_ONLY', 'NO_ACCESS'];\nexport const STYLES = FSSync.readdirSync(STYLES_PATH).filter((fileName) => {\n  return fileName.split('.').pop() === 'css' && !NON_THEME_STYLESHEETS.has(fileName.split('.').shift());\n}).map((fileName) => {\n  let name = fileName.split('.').slice(0, -1).join('.');\n  let match = /\\/\\*\\!\\s*([^\\*]+?)\\s*\\*\\//gi.exec(FSSync.readFileSync(`${STYLES_PATH}/${fileName}`, 'utf8'));\n  return {\n    name: name,\n    title: (match ? match[1] : name)\n  };\n});\n\nexport const CODE_STYLES = FSSync.readdirSync(CODE_STYLES_PATH).filter((fileName) => {\n  return fileName.split('.').pop() === 'css';\n}).map((fileName) => {\n  let name = fileName.split('.').slice(0, -1).join('.');\n  let match = /\\/\\*\\s*([^\\*]+?)\\s*\\*\\//gi.exec(FSSync.readFileSync(`${CODE_STYLES_PATH}/${fileName}`, 'utf8'));\n  return {\n    name: name,\n    title: (match ? match[1] : name)\n  };\n});\n\nexport function now() {\n  return new Date();\n}\n\nexport function mayBeHashpass(password) {\n  return (typeof password === 'string') && password.match(/^([0-9a-fA-F]){40}$/);\n}\n\nexport function correctAddress(ip) {\n  if (!ip || typeof ip !== 'string') {\n    return null;\n  }\n  if ('::1' === ip) {\n    ip = '127.0.0.1';\n  }\n  let match = ip.match(/^\\:\\:ffff\\:(\\d+\\.\\d+\\.\\d+\\.\\d+)$/);\n  if (match) {\n    ip = match[1];\n  }\n  if (ip.replace(':', '') === ip) {\n    ip = '::' + ip;\n  }\n  try {\n    let address = new Address6(ip);\n    if (address.isValid()) {\n      return address.correctForm();\n    }\n  } catch (err) {\n    //\n  }\n  try {\n    let address = Address6.fromAddress4(ip);\n    if (address.isValid()) {\n      return address.correctForm();\n    }\n  } catch (err) {\n    //\n  }\n  return null;\n}\n\nexport function binaryAddress(address) {\n  if (!(address instanceof Address6)) {\n    address = new Address6(correctAddress(address));\n  }\n  return Buffer.from(address.toUnsignedByteArray());\n}\n\nexport function subnet(ip, s) {\n  s = +s;\n  if (isNaN(s) || s <= 0) {\n    return null;\n  }\n  let ns = s;\n  if (ns <= IP_V4_MAX_SUBNET) {\n    ns = IP_V6_MAX_SUBNET - (IP_V4_MAX_SUBNET - ns);\n  }\n  try {\n    let address = new Address6(`${correctAddress(ip)}/${ns}`);\n    if (!+address.possibleSubnets(ns)) {\n      return null;\n    }\n    return {\n      subnet: s,\n      start: binaryAddress(address.startAddress()),\n      end: binaryAddress(address.endAddress())\n    };\n  } catch (err) {\n    return null;\n  }\n}\n\nexport function preferIPv4(ip) {\n  if (!ip) {\n    return null;\n  }\n  try {\n    let address = new Address6(ip);\n    let ipv4 = address.to4();\n    if (ipv4.isValid()) {\n      ipv4 = ipv4.correctForm();\n      return ('0.0.0.1' === ipv4) ? '127.0.0.1' : ipv4;\n    }\n    if (address.isValid()) {\n      return address.correctForm();\n    }\n    return ip;\n  } catch (err) {\n    //\n  }\n  return ip;\n}\n\nexport function crypto(algorithm, data, encoding = 'hex') {\n  if (!data || (typeof data !== 'string' && !Util.isBuffer(data))) {\n    return null;\n  }\n  let hash = Crypto.createHash(algorithm);\n  hash.update(data);\n  return hash.digest(encoding);\n}\n\nexport function sha1() {\n  return crypto('sha1', ...arguments);\n}\n\nexport async function series(arr, f, container) {\n  if (container && typeof container !== 'object') {\n    container = [];\n  }\n  let isArray = _(container).isArray();\n  let isObject = (typeof container === 'object');\n  let p = Promise.resolve();\n  if (_(arr).isArray()) {\n    arr.forEach((el, index) => {\n      p = p.then(() => {\n        return f(el, index);\n      }).then((result) => {\n        if (isArray) {\n          container.push(result);\n        } else if (isObject) {\n          container[el] = result;\n        }\n      });\n    });\n  } else if (_(arr).isObject()) {\n    _(arr).each((el, key) => {\n      p = p.then(() => {\n        return f(el, key);\n      }).then((result) => {\n        if (isArray) {\n          container.push(result);\n        } else if (isObject) {\n          container[key] = result;\n        }\n      });\n    });\n  }\n  if (!container) {\n    return p;\n  }\n  return p.then(() => { return container; });\n}\n\nexport function ipList(s) {\n  let ips = (s || '').split(/\\s+/).filter(ip => !!ip);\n  //TODO: IP ranges\n  ips = ips.map(ip => correctAddress(ip));\n  if (ips.some(ip => !ip)) {\n    returntranslate('Invalid IP address');\n  }\n  return _(ips).uniq();\n}\n\nexport function option(source, acceptable, def, { strict, invert, test } = {}) {\n  if (typeof source === 'undefined') {\n    return def;\n  }\n  if (!_(acceptable).isArray()) {\n    acceptable = [acceptable];\n  }\n  let converted = source;\n  let accepted = acceptable.filter((a) => { return typeof a === 'string' && JS_TYPES.has(a); }).some((a) => {\n    if (typeof source === a) {\n      return true;\n    }\n    if (strict) {\n      return false;\n    }\n    switch (a) {\n    case 'number':\n      converted = +source;\n      return !isNaN(converted);\n    case 'boolean':\n      converted = !!source;\n      return true;\n    case 'string':\n      converted = '' + source;\n      return true;\n    break;\n    }\n  });\n  if (invert) {\n    accepted = !accepted;\n  }\n  if (typeof test === 'function') {\n    accepted = accepted && test(converted);\n  } else if (_(test).isRegExp()) {\n    accepted = accepted && test.test(converted);\n  }\n  return accepted ? converted : def;\n}\n\nexport function testPostNumber(postNumber) {\n  return postNumber > 0;\n}\n\nexport function cloned(value) {\n  if (_(value).isArray()) {\n    return value.slice(0).map(val => cloned(val));\n  } else if (_(value).isObject()) {\n    return merge.recursive(true, value);\n  } else {\n    return value;\n  }\n}\n\nexport function addIPv4(object, ip) {\n  ip = ip || (object && object.ip);\n  if (!ip) {\n    return object;\n  }\n  let ipv4 = preferIPv4(ip);\n  if (ipv4 && ipv4 !== ip) {\n    object.ipv4 = ipv4;\n  }\n  return object;\n}\n\nexport function compareRegisteredUserLevels(l1, l2) {\n  return REGISTERED_USER_LEVELS.indexOf(l1) - REGISTERED_USER_LEVELS.indexOf(l2);\n}\n\nexport function requireWrapper(m) {\n  return (m && m.default) || m;\n}\n\nexport function loadPlugins(paths, filter, keepCache) {\n  if (typeof filter !== 'function') {\n    if (typeof filter === 'undefined' || filter) {\n      filter = (fileName) => { return 'index.js' !== fileName; };\n    } else {\n      filter = () => true;\n    }\n  }\n  if (!_(paths).isArray()) {\n    paths = [paths];\n  }\n  let list = paths.map((path, pathIndex) => {\n    return FSSync.readdirSync(path).filter((fileName) => {\n      return fileName.split('.').pop() === 'js';\n    }).filter((fileName, index, fileNames) => {\n      return filter(fileName, index, fileNames, path, pathIndex);\n    }).map((fileName) => {\n      let id = require.resolve(`${path}/${fileName}`);\n      if (!keepCache && require.cache.hasOwnProperty(id)) {\n        delete require.cache[id];\n      }\n      let plugins = requireWrapper(require(id));\n      if (!_(plugins).isArray()) {\n        plugins = [plugins];\n      }\n      return plugins;\n    });\n  });\n  return _(list).flatten();\n}\n\nexport function toHashpass(password, notHashpass) {\n  if (notHashpass || !mayBeHashpass(password)) {\n    password = sha1(password);\n  }\n  return password;\n}\n\nexport function processError(err, dir) {\n  if ('ENOENT' === err.code) {\n    err.status = 404;\n  } else if (typeof dir !== 'undefined') {\n    if (dir && 'ENOTDIR' === err.code) {\n      err = new Error(Tools.translate('Not a directory'));\n    } else if (!dir && 'EISDIR' === err.code) {\n      err = new Error(Tools.translate('Not a file'));\n    }\n  }\n  return err;\n}\n\nexport function pad(what, length, ch) {\n  what = '' + what;\n  length = option(length, 'number', 2, { test: (l) => { return l > 0; } });\n  if (!length) {\n    return what;\n  }\n  if (length - what.length <= 0) {\n    return what;\n  }\n  return new Array(length - what.length + 1).join((ch || '0').toString()[0]) + what;\n}\n\nexport function chunk(array, size) {\n  return array.reduce((res, item, index) => {\n    if (index % size === 0) {\n      res.push([]);\n    }\n    res[res.length - 1].push(item);\n    return res;\n  }, []);\n}\n\nexport function escapeRegExp(text) {\n  if (typeof text !== 'string') {\n    return text;\n  }\n  return text.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&');\n}\n\nexport function create404Error(baseUrl) {\n  let err = new Error();\n  err.status = 404;\n  err.path = baseUrl;\n  return err;\n}\n"]}