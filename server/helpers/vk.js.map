{"version":3,"sources":["helpers/vk.js"],"names":[],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA;;;;AACA;;IAAY,K;;;;;;;;AAGZ,IAAM,sBAAsB,MAAM,MAAlC;;;sDAEe,iBAAe,MAAf,EAAuB,MAAvB;AAAA,QAYT,QAZS,EAoBT,IApBS,EAqBT,MArBS;AAAA;AAAA;AAAA;AAAA;AAAA,gBACR,MADQ;AAAA;AAAA;AAAA;;AAAA,kBAEL,IAAI,KAAJ,CAAU,MAAM,SAAN,CAAgB,uBAAhB,CAAV,CAFK;;AAAA;AAIb,qBAAS,UAAU,EAAnB;AACA,mBAAO,YAAP,GAAsB,sBAAO,4BAAP,CAAtB;AACA,qBAAS,0BAAE,MAAF,EAAU,GAAV,CAAc,UAAC,KAAD,EAAQ,GAAR,EAAgB;AACrC,kBAAI,CAAC,0BAAE,KAAF,EAAS,OAAT,EAAL,EAAyB;AACvB,wBAAQ,CAAC,KAAD,CAAR;AACD;AACD,qBAAO,MAAM,GAAN,CAAU,UAAC,CAAD;AAAA,uBAAU,GAAV,SAAiB,KAAjB;AAAA,eAAV,EAAoC,IAApC,CAAyC,GAAzC,CAAP;AACD,aALQ,EAKN,IALM,CAKD,GALC,CAAT;AANa;AAAA,mBAYQ,eAAK,OAAL,CAAa;AAChC,kDAAkC,MAAlC,SAA4C,MADZ;AAEhC,sBAAQ,MAFwB;AAGhC,uBAAS;AAHuB,aAAb,CAZR;;AAAA;AAYT,oBAZS;;AAAA,kBAiBT,QAAQ,SAAS,MAjBR;AAAA;AAAA;AAAA;;AAAA,kBAkBL,IAAI,KAAJ,CAAU,MAAM,SAAN,CAAgB,8BAAhB,CAAV,CAlBK;;AAAA;AAAA;AAAA,mBAoBI,SAAS,IAAT,CAAc,IAAd,EApBJ;;AAAA;AAoBT,gBApBS;AAqBT,kBArBS,GAqBA,KAAK,KAAL,CAAW,KAAK,QAAL,EAAX,CArBA;;AAAA,iBAsBT,OAAO,KAtBE;AAAA;AAAA;AAAA;;AAAA,kBAuBL,IAAI,KAAJ,CAAU,OAAO,KAAP,CAAa,SAAvB,CAvBK;;AAAA;AAAA,6CAyBN,OAAO,QAzBD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","file":"helpers/vk.js","sourcesContent":["import _ from 'underscore';\nimport HTTP from 'q-io/http';\n\nimport config from './config';\nimport * as Tools from './tools';\n\n\nconst VK_API_CALL_TIMEOUT = Tools.MINUTE;\n\nexport default async function(method, params) {\n  if (!method) {\n    throw new Error(Tools.translate('Invalid VK API method'));\n  }\n  params = params || {};\n  params.access_token = config('site.vkontakte.accessToken');\n  params = _(params).map((value, key) => {\n    if (!_(value).isArray()) {\n      value = [value];\n    }\n    return value.map((v) => `${key}=${value}`).join('&');\n  }).join('&');\n  let response = await HTTP.request({\n    url: `https://api.vk.com/method/${method}?${params}`,\n    method: 'POST',\n    timeout: VK_API_CALL_TIMEOUT\n  });\n  if (200 !== response.status) {\n    throw new Error(Tools.translate('Failed to call VK API method'));\n  }\n  let data = await response.body.read();\n  let result = JSON.parse(data.toString());\n  if (result.error) {\n    throw new Error(result.error.error_msg);\n  }\n  return result.response;\n}\n"],"sourceRoot":"/source/"}