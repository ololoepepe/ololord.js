{"version":3,"sources":["helpers/vk.js"],"names":["Tools","VK_API_CALL_TIMEOUT","MINUTE","method","params","Error","translate","access_token","map","value","key","isArray","v","join","request","url","timeout","response","status","body","read","data","result","JSON","parse","toString","error","error_msg"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA;;;;AACA;;IAAYA,K;;;;;;;;AAGZ,IAAMC,sBAAsBD,MAAME,MAAlC;;;uDAEe,iBAAeC,MAAf,EAAuBC,MAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBACRD,MADQ;AAAA;AAAA;AAAA;;AAAA,kBAEL,IAAIE,KAAJ,CAAUL,MAAMM,SAAN,CAAgB,uBAAhB,CAAV,CAFK;;AAAA;AAIbF,qBAASA,UAAU,EAAnB;AACAA,mBAAOG,YAAP,GAAsB,sBAAO,4BAAP,CAAtB;AACAH,qBAAS,0BAAEA,MAAF,EAAUI,GAAV,CAAc,UAACC,KAAD,EAAQC,GAAR,EAAgB;AACrC,kBAAI,CAAC,0BAAED,KAAF,EAASE,OAAT,EAAL,EAAyB;AACvBF,wBAAQ,CAACA,KAAD,CAAR;AACD;AACD,qBAAOA,MAAMD,GAAN,CAAU,UAACI,CAAD;AAAA,uBAAUF,GAAV,SAAiBD,KAAjB;AAAA,eAAV,EAAoCI,IAApC,CAAyC,GAAzC,CAAP;AACD,aALQ,EAKNA,IALM,CAKD,GALC,CAAT;AANa;AAAA,mBAYQ,eAAKC,OAAL,CAAa;AAChCC,kDAAkCZ,MAAlC,SAA4CC,MADZ;AAEhCD,sBAAQ,MAFwB;AAGhCa,uBAASf;AAHuB,aAAb,CAZR;;AAAA;AAYTgB,oBAZS;;AAAA,kBAiBT,QAAQA,SAASC,MAjBR;AAAA;AAAA;AAAA;;AAAA,kBAkBL,IAAIb,KAAJ,CAAUL,MAAMM,SAAN,CAAgB,8BAAhB,CAAV,CAlBK;;AAAA;AAAA;AAAA,mBAoBIW,SAASE,IAAT,CAAcC,IAAd,EApBJ;;AAAA;AAoBTC,gBApBS;AAqBTC,kBArBS,GAqBAC,KAAKC,KAAL,CAAWH,KAAKI,QAAL,EAAX,CArBA;;AAAA,iBAsBTH,OAAOI,KAtBE;AAAA;AAAA;AAAA;;AAAA,kBAuBL,IAAIrB,KAAJ,CAAUiB,OAAOI,KAAP,CAAaC,SAAvB,CAvBK;;AAAA;AAAA,6CAyBNL,OAAOL,QAzBD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","file":"vk.js","sourcesContent":["import _ from 'underscore';\nimport HTTP from 'q-io/http';\n\nimport config from './config';\nimport * as Tools from './tools';\n\n\nconst VK_API_CALL_TIMEOUT = Tools.MINUTE;\n\nexport default async function(method, params) {\n  if (!method) {\n    throw new Error(Tools.translate('Invalid VK API method'));\n  }\n  params = params || {};\n  params.access_token = config('site.vkontakte.accessToken');\n  params = _(params).map((value, key) => {\n    if (!_(value).isArray()) {\n      value = [value];\n    }\n    return value.map((v) => `${key}=${value}`).join('&');\n  }).join('&');\n  let response = await HTTP.request({\n    url: `https://api.vk.com/method/${method}?${params}`,\n    method: 'POST',\n    timeout: VK_API_CALL_TIMEOUT\n  });\n  if (200 !== response.status) {\n    throw new Error(Tools.translate('Failed to call VK API method'));\n  }\n  let data = await response.body.read();\n  let result = JSON.parse(data.toString());\n  if (result.error) {\n    throw new Error(result.error.error_msg);\n  }\n  return result.response;\n}\n"]}