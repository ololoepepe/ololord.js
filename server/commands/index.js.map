{"version":3,"sources":["commands/index.js"],"names":["commands","Tools","vorpal","require","setupMethods","command","prompt","options","Promise","resolve","reject","simple","message","name","call","result","input","requestPassword","type","translate","password","Error","mayBeHashpass","notHashpass","default","hashpass","installHandler","handler","description","alias","undefined","action","args","callback","console","log","stack","cancel","isArray","forEach","option","value","find","remove","basicOnly","plugins","loadPlugins","__dirname","fileName","_1","_2","path","split","filter","plugin","basic","delimiter","show"],"mappings":"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","file":"index.js","sourcesContent":["import _ from 'underscore';\n\nimport config from '../helpers/config';\nimport * as Tools from '../helpers/tools';\n\nconst vorpal = require('vorpal')();\n\nfunction setupMethods(command) {\n  let prompt = command.prompt;\n\n  command.prompt = async function(options) {\n    return new Promise((resolve, reject) => {\n      let simple = (typeof options === 'string');\n      if (simple) {\n        options = {\n          message: options,\n          name: 'input'\n        };\n      }\n      prompt.call(command, options, (result) => {\n        resolve(simple ? result.input : result);\n      });\n    });\n  };\n\n  command.requestPassword = async function() {\n    let result = await command.prompt({\n      type: 'password',\n      name: 'password',\n      message: Tools.translate('Enter password: ')\n    });\n    let password = result.password;\n    if (!password) {\n      throw new Error(Tools.translate('Invalid password'));\n    }\n    if (!Tools.mayBeHashpass(password)) {\n      return {\n        password: password,\n        notHashpass: true\n      };\n    }\n    result = await command.prompt({\n      type: 'confirm',\n      name: 'hashpass',\n      default: true,\n      message: Tools.translate(\"That is a hashpass, isn't it? \")\n    });\n    return {\n      password: password,\n      notHashpass: !result || !result.hashpass\n    };\n  };\n}\n\nvorpal.installHandler = function(command, handler, { description, alias, options } = {}) {\n  command = vorpal.command(command, description || undefined).action(async function(args, callback) {\n    try {\n      setupMethods(this);\n      let result = await handler.call(this, args);\n      if (result) {\n        console.log(result);\n      }\n      callback();\n    } catch (err) {\n      console.log(err.stack || err);\n      callback();\n    }\n  }).cancel(() => {\n    console.log(Tools.translate('Cancelled'));\n  });\n  if (alias) {\n    if (_(alias).isArray()) {\n      command.alias(...alias);\n    } else {\n      command.alias(alias);\n    }\n  }\n  if (_(options).isArray()) {\n    options.forEach((option) => {\n      command.option(option.value, option.description || undefined);\n    });\n  }\n};\n\nvorpal.find('exit').remove();\n\nexport default function commands(basicOnly, prompt) {\n  let plugins = Tools.loadPlugins([__dirname, `${__dirname}/custom`], (fileName, _1, _2, path) => {\n    return ('index.js' !== fileName) || (path.split('/') === 'custom');\n  }).filter(plugin => config(`system.commands.${plugin.command.split(/\\s/)[0]}`, true));\n  if (basicOnly) {\n    plugins = plugins.filter(plugin => plugin.basic);\n  }\n  plugins.forEach((plugin) => {\n    vorpal.installHandler(plugin.command, plugin.handler, plugin.options);\n  });\n  console.log(Tools.translate(\"Type 'help' for commands\"));\n  vorpal.delimiter(prompt || 'ololord.js>').show();\n  return vorpal;\n}\n"]}