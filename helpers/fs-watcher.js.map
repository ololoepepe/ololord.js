{"version":3,"sources":["helpers/fs-watcher.js"],"names":[],"mappings":";;;;;;;;AAAA;;AACA;;;;AACA;;;;;;;;;;;;;;IAEqB,O;;;AACnB,mBAAY,QAAZ,EAAsB;AAAA;;AAAA;;AAEpB,UAAK,QAAL,GAAgB,QAAhB;AACA,UAAK,YAAL;AAHoB;AAIrB;;;;;;;;YAOK,M;;;;;AAJJ,oBAAI,KAAK,OAAT,EAAkB;AAChB,uBAAK,OAAL,CAAa,kBAAb,CAAgC,QAAhC;AACA,uBAAK,OAAL,CAAa,KAAb;AACD;;uBACkB,aAAG,MAAH,CAAU,KAAK,QAAf,C;;;AAAf,sB;;oBACC,M;;;;;;;;AAGL,qBAAK,OAAL,GAAe,aAAO,KAAP,CAAa,KAAK,QAAlB,CAAf;AACA,qBAAK,OAAL,CAAa,EAAb,CAAgB,QAAhB,EAA0B,UAAC,IAAD,EAAO,QAAP,EAAoB;AAC5C,sBAAI,aAAa,IAAjB,EAAuB;AACrB,wBAAI,OAAK,QAAL,CAAc,KAAd,CAAoB,GAApB,EAAyB,GAAzB,OAAmC,QAAvC,EAAiD;AAC/C;AACD;AACD,2BAAK,YAAL;AACD,mBALD,MAKO,IAAI,aAAa,IAAjB,EAAuB;AAC5B,2BAAK,IAAL,CAAU,QAAV;AACD;AACF,iBATD;;;;;;;;;;;;;;;;;;;;;kBAjBiB,O","file":"helpers/fs-watcher.js","sourcesContent":["import { EventEmitter } from 'events';\nimport FS from 'q-io/fs';\nimport FSSync from 'fs';\n\nexport default class Watcher extends EventEmitter {\n  constructor(fileName) {\n    super();\n    this.fileName = fileName;\n    this.resetWatcher();\n  }\n\n  async resetWatcher() {\n    if (this.watcher) {\n      this.watcher.removeAllListeners('change');\n      this.watcher.close();\n    }\n    let exists = await FS.exists(this.fileName);\n    if (!exists) {\n      return;\n    }\n    this.watcher = FSSync.watch(this.fileName);\n    this.watcher.on('change', (type, fileName) => {\n      if ('rename' === type) {\n        if (this.fileName.split('/').pop() !== fileName) {\n          return;\n        }\n        this.resetWatcher();\n      } else if ('change' === type) {\n        this.emit('change');\n      }\n    });\n  }\n}\n"],"sourceRoot":"/source/"}