{"version":3,"sources":["helpers/tools.js"],"names":[],"mappings":"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","file":"helpers/tools.js","sourcesContent":["import _ from 'underscore';\nimport { Address4, Address6 } from 'ip-address';\nimport Crypto from 'crypto';\nimport escapeHTML from 'escape-html';\nimport FSSync from 'fs';\nimport merge from 'merge';\nimport Util from 'util';\n\nimport config from './config';\n\nlet translate = require('cute-localize')({\n  locale: config('site.locale'),\n  extraLocations: `${__dirname}/../translations/custom`,\n  silent: true\n});\n\nconfig.on('site.locale', (locale) => { translate.setLocale(locale); });\n\nexport { translate as translate };\n\nconst NON_THEME_STYLESHEETS = new Set(['', 'custom-'].reduce((acc, prefix) => {\n  return acc.concat(['combined', 'desktop', 'mobile'].map(suffix => `${prefix}base-${suffix}`));\n}, []));\nconst STYLES_PATH = `${__dirname}/../public/css`;\nconst CODE_STYLES_PATH = `${__dirname}/../public/css/3rdparty/highlight.js`;\nconst JS_TYPES = new Set(['string', 'boolean', 'number', 'object']);\n\nexport const SECOND = 1000;\nexport const MINUTE = 60 * SECOND;\nexport const HOUR = 60 * MINUTE;\nexport const DAY = 24 * HOUR;\nexport const EXTERNAL_LINK_REGEXP_PATTERN = (function() {\n    var schema = \"https?:\\\\/\\\\/|ftp:\\\\/\\\\/\";\n    var ip = \"(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}\"\n        + \"(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\";\n    var hostname = \"([\\\\w\\\\p{L}\\\\.\\\\-]+)\\\\.([\\\\p{L}]{2,17}\\\\.?)\";\n    var port = \":\\\\d+\";\n    var path = \"(\\\\/[\\\\w\\\\p{L}\\\\.\\\\-\\\\!\\\\?\\\\=\\\\+#~&%:;\\'\\\"\\\\,\\\\(\\\\)\\\\[\\\\]«»]*)*\\\\/?\";\n    return \"(\" + schema + \")?(\" + hostname + \"|\" + ip + \")(\" + port + \")?\" + path;\n})();\nexport const FILE_RATINGS = ['SFW', 'R-15', 'R-18', 'R-18G'];\nexport const NODE_CAPTCHA_ID = 'node-captcha';\nexport const REGISTERED_USER_LEVELS = ['USER', 'MODER', 'ADMIN', 'SUPERUSER'];\nexport const BAN_LEVELS = ['NONE', 'READ_ONLY', 'NO_ACCESS'];\nexport const STYLES = FSSync.readdirSync(STYLES_PATH).filter((fileName) => {\n  return fileName.split('.').pop() === 'css' && !NON_THEME_STYLESHEETS.has(fileName.split('.').shift());\n}).map((fileName) => {\n  let name = fileName.split('.').slice(0, -1).join('.');\n  let match = /\\/\\*\\s*([^\\*]+?)\\s*\\*\\//gi.exec(FSSync.readFileSync(`${STYLES_PATH}/${fileName}`, 'utf8'));\n  return {\n    name: name,\n    title: (match ? match[1] : name)\n  };\n});\n\nexport const CODE_STYLES = FSSync.readdirSync(CODE_STYLES_PATH).filter((fileName) => {\n  return fileName.split('.').pop() === 'css';\n}).map((fileName) => {\n  let name = fileName.split('.').slice(0, -1).join('.');\n  let match = /\\/\\*\\s*([^\\*]+?)\\s*\\*\\//gi.exec(FSSync.readFileSync(`${CODE_STYLES_PATH}/${fileName}`, 'utf8'));\n  return {\n    name: name,\n    title: (match ? match[1] : name)\n  };\n});\n\nexport function now() {\n  return new Date();\n}\n\nexport function toHtml(text, replaceSpaces) {\n  text = escapeHTML(text).split('\\n').join('<br />');\n  if (replaceSpaces) {\n    text = text.split(' ').join('&nbsp;');\n  }\n  return text;\n}\n\nexport function mayBeHashpass(password) {\n  return (typeof password === 'string') && password.match(/^([0-9a-fA-F]){40}$/);\n}\n\nexport function correctAddress(ip) {\n  if (!ip || typeof ip !== 'string') {\n    return null;\n  }\n  if ('::1' === ip) {\n    ip = '127.0.0.1';\n  }\n  let match = ip.match(/^\\:\\:ffff\\:(\\d+\\.\\d+\\.\\d+\\.\\d+)$/);\n  if (match) {\n    ip = match[1];\n  }\n  if (ip.replace(':', '') === ip) {\n    ip = '::' + ip;\n  }\n  try {\n    let address = new Address6(ip);\n    if (address.isValid()) {\n      return address.correctForm();\n    }\n  } catch (err) {\n    //\n  }\n  try {\n    let address = Address6.fromAddress4(ip);\n    if (address.isValid()) {\n      return address.correctForm();\n    }\n  } catch (err) {\n    //\n  }\n  return null;\n}\n\nexport function preferIPv4(ip) {\n  if (!ip) {\n    return null;\n  }\n  try {\n    let address = new Address6(ip);\n    let ipv4 = address.to4();\n    if (ipv4.isValid()) {\n      ipv4 = ipv4.correctForm();\n      return ('0.0.0.1' === ipv4) ? '127.0.0.1' : ipv4;\n    }\n    if (address.isValid()) {\n      return address.correctForm();\n    }\n    return ip;\n  } catch (err) {\n    //\n  }\n  return ip;\n}\n\nexport function crypto(algorithm, data, encoding = 'hex') {\n  if (!data || (typeof data !== 'string' && !Util.isBuffer(data))) {\n    return null;\n  }\n  let hash = Crypto.createHash(algorithm);\n  hash.update(data);\n  return hash.digest(encoding);\n}\n\nexport function sha1() {\n  return crypto('sha1', ...arguments);\n}\n\nexport async function series(arr, f, container) {\n  if (container && typeof container !== 'object') {\n    container = [];\n  }\n  let isArray = _(container).isArray();\n  let isObject = (typeof container === 'object');\n  let p = Promise.resolve();\n  if (_(arr).isArray()) {\n    arr.forEach((el, index) => {\n      p = p.then(() => {\n        return f(el, index);\n      }).then((result) => {\n        if (isArray) {\n          container.push(result);\n        } else if (isObject) {\n          container[el] = result;\n        }\n      });\n    });\n  } else if (_(arr).isObject()) {\n    _(arr).each((el, key) => {\n      p = p.then(() => {\n        return f(el, key);\n      }).then((result) => {\n        if (isArray) {\n          container.push(result);\n        } else if (isObject) {\n          container[key] = result;\n        }\n      });\n    });\n  }\n  if (!container) {\n    return p;\n  }\n  return p.then(() => { return container; });\n}\n\nexport function ipList(s) {\n  let ips = (s || '').split(/\\s+/).filter(ip => !!ip);\n  //TODO: IP ranges\n  ips = ips.map(ip => correctAddress(ip));\n  if (ips.some(ip => !ip)) {\n    returntranslate('Invalid IP address');\n  }\n  return _(ips).uniq();\n}\n\nexport function option(source, acceptable, def, { strict, invert, test } = {}) {\n  if (typeof source === 'undefined') {\n    return def;\n  }\n  if (!_(acceptable).isArray()) {\n    acceptable = [acceptable];\n  }\n  let converted = source;\n  let accepted = acceptable.filter((a) => { return typeof a === 'string' && JS_TYPES.has(a); }).some((a) => {\n    if (typeof source === a) {\n      return true;\n    }\n    if (strict) {\n      return false;\n    }\n    switch (a) {\n    case 'number':\n      converted = +source;\n      return !isNaN(converted);\n    case 'boolean':\n      converted = !!source;\n      return true;\n    case 'string':\n      converted = '' + source;\n      return true;\n    break;\n    }\n  });\n  if (invert) {\n    accepted = !accepted;\n  }\n  if (typeof test === 'function') {\n    accepted = accepted && test(converted);\n  } else if (_(test).isRegExp()) {\n    accepted = accepted && test.test(converted);\n  }\n  return accepted ? converted : def;\n}\n\nexport function testPostNumber(postNumber) {\n  return postNumber > 0;\n}\n\nexport function cloned(value) {\n  if (_(value).isArray()) {\n    return value.slice(0).map(val => cloned(val));\n  } else if (_(value).isObject()) {\n    return merge.recursive(true, value);\n  } else {\n    return value;\n  }\n}\n\nexport function addIPv4(object, ip) {\n  ip = ip || (object && object.ip);\n  if (!ip) {\n    return object;\n  }\n  let ipv4 = preferIPv4(ip);\n  if (ipv4 && ipv4 !== ip) {\n    object.ipv4 = ipv4;\n  }\n  return object;\n}\n\nexport function compareRegisteredUserLevels(l1, l2) {\n  return REGISTERED_USER_LEVELS.indexOf(l1) - REGISTERED_USER_LEVELS.indexOf(l2);\n}\n\nexport function requireWrapper(m) {\n  return (m && m.default) || m;\n}\n\nexport function loadPlugins(paths, filter) {\n  if (typeof filter !== 'function') {\n    if (typeof filter === 'undefined' || filter) {\n      filter = (fileName) => { return 'index.js' !== fileName; };\n    } else {\n      filter = () => true;\n    }\n  }\n  if (!_(paths).isArray()) {\n    paths = [paths];\n  }\n  let list = paths.map((path, pathIndex) => {\n    return FSSync.readdirSync(path).filter((fileName) => {\n      return fileName.split('.').pop() === 'js';\n    }).filter((fileName, index, fileNames) => {\n      return filter(fileName, index, fileNames, path, pathIndex);\n    }).map((fileName) => {\n      let id = require.resolve(`${path}/${fileName}`);\n      if (require.cache.hasOwnProperty(id)) {\n        delete require.cache[id];\n      }\n      let plugins = requireWrapper(require(id));\n      if (!_(plugins).isArray()) {\n        plugins = [plugins];\n      }\n      return plugins;\n    });\n  });\n  return _(list).flatten();\n}\n\nexport function toHashpass(password, notHashpass) {\n  if (notHashpass || !mayBeHashpass(password)) {\n    password = sha1(password);\n  }\n  return password;\n}\n\nexport function processError(err, dir) {\n  if ('ENOENT' === err.code) {\n    err.status = 404;\n  } else if (typeof dir !== 'undefined') {\n    if (dir && 'ENOTDIR' === err.code) {\n      err = new Error(Tools.translate('Not a directory'));\n    } else if (!dir && 'EISDIR' === err.code) {\n      err = new Error(Tools.translate('Not a file'));\n    }\n  }\n  return err;\n}\n\nexport function pad(what, length, ch) {\n  what = '' + what;\n  length = option(length, 'number', 2, { test: (l) => { return l > 0; } });\n  if (!length) {\n    return what;\n  }\n  if (length - what.length <= 0) {\n    return what;\n  }\n  return Array(length - what.length + 1).join((ch || '0').toString()[0]) + what;\n}\n\nexport function chunk(array, size) {\n  return array.reduce((res, item, index) => {\n    if (index % size === 0) {\n      res.push([]);\n    }\n    res[res.length - 1].push(item);\n    return res;\n  }, []);\n}\n"],"sourceRoot":"/source/"}