{"version":3,"sources":["helpers/online-counter.js"],"names":[],"mappings":";;AAAA,IAAI,SAAS,QAAQ,mBAAR,CAAb;AACA,IAAI,QAAQ,QAAQ,kBAAR,CAAZ;;AAEA,IAAI,QAAQ,IAAI,GAAJ,EAAZ;AACA,IAAI,QAAQ,OAAO,4BAAP,EAAqC,IAAI,MAAM,MAA/C,CAAZ,C;AACA,IAAI,WAAW,OAAO,+BAAP,EAAwC,MAAM,MAA9C,CAAf,C;;AAEA,YAAY,YAAW;AACnB,UAAM,OAAN,CAAc,UAAS,CAAT,EAAY,EAAZ,EAAgB;AAC1B,aAAK,QAAL;AACA,YAAI,IAAI,CAAR,EACI,MAAM,GAAN,CAAU,EAAV,EAAc,CAAd,EADJ,KAGI,MAAM,MAAN,CAAa,EAAb;AACP,KAND;AAOH,CARD,EAQG,QARH;;AAUA,OAAO,OAAP,CAAe,KAAf,GAAuB,UAAS,EAAT,EAAa;AAChC,UAAM,GAAN,CAAU,EAAV,EAAc,KAAd;AACH,CAFD;;AAIA,OAAO,OAAP,CAAe,MAAf,GAAwB,YAAW;AAC/B,QAAI,IAAI,EAAR;AAD+B;AAAA;AAAA;;AAAA;AAE/B,6BAAe,MAAM,IAAN,EAAf;AAAA,gBAAS,EAAT;;AACI,cAAE,EAAF,IAAQ,CAAR;AADJ;AAF+B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAI/B,WAAO,CAAP;AACH,CALD;;AAOA,OAAO,OAAP,CAAe,KAAf,GAAuB,YAAW;AAC9B,UAAM,KAAN;AACH,CAFD","file":"helpers/online-counter.js","sourcesContent":["var config = require(\"../helpers/config\");\nvar Tools = require(\"../helpers/tools\");\n\nvar users = new Map();\nvar quota = config(\"system.onlineCounter.quota\", 5 * Tools.MINUTE); //TODO: magic numbers\nvar interval = config(\"system.onlineCounter.interval\", Tools.MINUTE); //TODO: magic numbers\n\nsetInterval(function() {\n    users.forEach(function(q, ip) {\n        q -= interval;\n        if (q > 0)\n            users.set(ip, q);\n        else\n            users.delete(ip);\n    });\n}, interval);\n\nmodule.exports.alive = function(ip) {\n    users.set(ip, quota);\n};\n\nmodule.exports.unique = function() {\n    var o = {};\n    for (var ip of users.keys())\n        o[ip] = 1;\n    return o;\n};\n\nmodule.exports.clear = function() {\n    users.clear();\n};\n"],"sourceRoot":"/source/"}