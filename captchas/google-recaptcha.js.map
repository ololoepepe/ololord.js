{"version":3,"sources":["captchas/google-recaptcha.js"],"names":[],"mappings":";;AAAA,IAAI,OAAO,QAAQ,WAAR,CAAX;;AAEA,IAAI,UAAU,QAAQ,WAAR,CAAd;AACA,IAAI,QAAQ,QAAQ,kBAAR,CAAZ;;AAEA,IAAI,kBAAkB,IAAI,OAAJ,CAAY,kBAAZ,EAAgC,MAAM,SAAN,CAAgB,IAAhB,CAAqB,kBAArB,CAAhC,CAAtB;;AAEA,gBAAgB,YAAhB,GAA+B,UAAS,EAAT,EAAa,MAAb,EAAqB;AAChD,QAAI,UAAU,OAAO,sBAAP,CAAd;AACA,QAAI,CAAC,OAAL,EACI,OAAO,QAAQ,MAAR,CAAe,MAAM,SAAN,CAAgB,kBAAhB,CAAf,CAAP;AACJ,QAAI,oBAAkB,KAAK,UAAvB,kBAA8C,OAA9C,kBAAkE,EAAtE;AACA,QAAI,MAAM,qDAAqD,KAA/D;AACA,WAAO,KAAK,OAAL,CAAa;AAChB,aAAK,GADW;AAEhB,iBAAU,KAAK,MAAM;AAFL,KAAb,EAGJ,IAHI,CAGC,UAAS,QAAT,EAAmB;AACvB,YAAI,SAAS,MAAT,IAAmB,GAAvB,EACI,OAAO,QAAQ,MAAR,CAAe,MAAM,SAAN,CAAgB,yBAAhB,CAAf,CAAP;AACJ,eAAO,SAAS,IAAT,CAAc,IAAd,CAAmB,MAAnB,CAAP;AACH,KAPM,EAOJ,IAPI,CAOC,UAAS,IAAT,EAAe;AACnB,YAAI,QAAQ,KAAK,KAAL,CAAW,KAAK,QAAL,EAAX,CAAZ;AACA,YAAI,CAAC,MAAM,OAAX,EAAoB;AAChB,gBAAI,MAAM,aAAN,EAAqB,OAArB,CAA6B,sBAA7B,KAAwD,CAA5D,EACI,OAAO,QAAQ,MAAR,CAAe,MAAM,SAAN,CAAgB,yCAAhB,CAAf,CAAP,CADJ,KAEK,IAAI,MAAM,aAAN,EAAqB,OAArB,CAA6B,sBAA7B,KAAwD,CAA5D,EACD,OAAO,QAAQ,MAAR,CAAe,MAAM,SAAN,CAAgB,sDAAhB,CAAf,CAAP,CADC,KAEA,IAAI,MAAM,aAAN,EAAqB,OAArB,CAA6B,wBAA7B,KAA0D,CAA9D,EACD,OAAO,QAAQ,MAAR,CAAe,MAAM,SAAN,CAAgB,2CAAhB,CAAf,CAAP,CADC,KAEA,IAAI,MAAM,aAAN,EAAqB,OAArB,CAA6B,wBAA7B,KAA0D,CAA9D,EACD,OAAO,QAAQ,MAAR,CAAe,MAAM,SAAN,CAAgB,wDAAhB,CAAf,CAAP,CADC,KAGD,OAAO,QAAQ,MAAR,CAAe,MAAM,SAAN,CAAgB,iBAAhB,CAAf,CAAP;AACP,SAXD,MAWO;AACH,mBAAO,QAAQ,OAAR,EAAP;AACH;AACJ,KAvBM,CAAP;AAwBH,CA9BD;;AAgCA,OAAO,OAAP,GAAiB,eAAjB","file":"captchas/google-recaptcha.js","sourcesContent":["var HTTP = require(\"q-io/http\");\n\nvar Captcha = require(\"./captcha\");\nvar Tools = require(\"../helpers/tools\");\n\nvar googleRecaptcha = new Captcha(\"google-recaptcha\", Tools.translate.noop(\"Google reCAPTCHA\"));\n\ngoogleRecaptcha.checkCaptcha = function(ip, fields) {\n    var captcha = fields[\"g-recaptcha-response\"];\n    if (!captcha)\n        return Promise.reject(Tools.translate(\"Captcha is empty\"));\n    var query = `secret=${this.privateKey}&response=${captcha}&remoteip=${ip}`;\n    var url = \"https://www.google.com/recaptcha/api/siteverify?\" + query;\n    return HTTP.request({\n        url: url,\n        timeout: (15 * Tools.Second)\n    }).then(function(response) {\n        if (response.status != 200)\n            return Promise.reject(Tools.translate(\"Failed to check captcha\"));\n        return response.body.read(\"utf8\");\n    }).then(function(data) {\n        var reply = JSON.parse(data.toString());\n        if (!reply.success) {\n            if (reply[\"error-codes\"].indexOf(\"missing-input-secret\") >= 0)\n                return Promise.reject(Tools.translate(\"The secret captcha parameter is missing\"));\n            else if (reply[\"error-codes\"].indexOf(\"invalid-input-secret\") >= 0)\n                return Promise.reject(Tools.translate(\"The secret captcha parameter is invalid or malformed\"));\n            else if (reply[\"error-codes\"].indexOf(\"missing-input-response\") >= 0)\n                return Promise.reject(Tools.translate(\"The captcha response parameter is missing\"));\n            else if (reply[\"error-codes\"].indexOf(\"invalid-input-response\") >= 0)\n                return Promise.reject(Tools.translate(\"The captcha response parameter is invalid or malformed\"));\n            else\n                return Promise.reject(Tools.translate(\"Invalid captcha\"));\n        } else {\n            return Promise.resolve();\n        }\n    });\n};\n\nmodule.exports = googleRecaptcha;\n"],"sourceRoot":"/source/"}